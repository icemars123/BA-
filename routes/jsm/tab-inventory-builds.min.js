var buildsTabWidgetsLoaded=!1;function doBuildsTabWidgets(){var e=[{text:"Clear",iconCls:"icon-clear",handler:function(){$("#divBuildsG").datagrid("clearSelections")}},{text:"Remove",iconCls:"icon-remove",handler:function(){doGridGetSelectedRowData("divBuildsG",function(t){doPromptOkCancel("Remove "+t.qtyinbuild+" of "+t.productcode+"?",function(e){e&&doServerDataMessage("expirebuild",{buildid:t.orderbuildid},{type:"refresh"})})})||doShowError("Please select a build to remove")}}];function t(){doServerMessage("listorderbuilds",{type:"refresh"})}buildsTabWidgetsLoaded||(buildsTabWidgetsLoaded=!0,$("#divEvents").on("listorderbuilds",function(e,t){var i=[];t.data.rs.forEach(function(e){i.push({orderbuildid:doNiceId(e.orderbuildid),orderid:doNiceId(e.orderid),orderno:doNiceString(e.orderno),productid:doNiceId(e.productid),productcode:doNiceString(e.productcode),buildtemplateid:doNiceId(e.buildtemplateid),qtyordered:_.formatnumber(e.qtyordered,4),qtyinbuild:_.formatnumber(e.qtyinbuild,4),qtybuilt:_.formatnumber(e.qtybuilt,4),dateordered:doNiceDate(e.dateordered),datebuilt:doNiceDate(e.datebuilt),userordered:doNiceTitleizeString(e.userordered),userbuilt:doNiceTitleizeString(e.userbuilt)})}),$("#divBuildsG").datagrid("loadData",i),$("#divBuildsG").datagrid("reloadFooter",[{name:'<span class="totals_footer">'+i.length+" Products</span>"}]),_.isUndefined(t.pdata.orderbuildid)||_.isNull(t.pdata.orderbuildid)||$("#divBuildsG").datagrid("selectRecord",t.pdata.orderbuildid)}),$("#divEvents").on("listorders",t),$("#divEvents").on("inventorybuilt",t),$("#divEvents").on("buildinventory",t),$("#divEvents").on("expirebuild",t),$("#divEvents").on("orderbuildspopup",function(e,t){"build"==t&&doBuild()}),$("#divBuildsG").datagrid({idField:"orderbuildid",fitColumns:!1,singleSelect:!0,rownumbers:!0,striped:!0,toolbar:e,showFooter:!0,sortName:"orderno",sortOrder:"asc",remoteSort:!1,multiSort:!0,frozenColumns:[[{title:"Order #",rowspan:2,field:"orderno",width:150,align:"left",resizable:!0,editor:"text",sortable:!0}],[]],columns:[[{title:"Product",rowspan:2,field:"productname",width:200,align:"left",resizable:!0,sortable:!0},{title:"Template",rowspan:2,field:"buildtemplateid",width:200,align:"left",resizable:!0,sortable:!0,formatter:function(e,t){return doGetNameFromTreeArray(cache_buildtemplates,e)}},{title:"Manufactured",colspan:4},{title:"Order",colspan:3}],[{title:"Qty",field:"qtyinbuild",width:100,align:"right",resizable:!0,sortable:!0,editor:{type:"numberbox",options:{groupSeparator:",",precision:0}},formatter:function(e,t,i){return _.niceformatqty(e)}},{title:"Total Built",field:"qtybuilt",width:100,align:"right",resizable:!0,sortable:!0,editor:{type:"numberbox",options:{groupSeparator:",",precision:0}},formatter:function(e,t,i){return _.niceformatqty(e)}},{title:"Date",field:"datebuilt",width:150,align:"right",resizable:!0,sortable:!0},{title:"By",field:"userbuilt",width:200,align:"left",resizable:!0,sortable:!0},{title:"Qty",field:"qtyordered",width:100,align:"right",resizable:!0,sortable:!0,formatter:function(e,t,i){return _.niceformatqty(e)}},{title:"Date",field:"dateordered",width:150,align:"right",resizable:!0,sortable:!0},{title:"By",field:"userordered",width:200,align:"left",resizable:!0,sortable:!0}]],onRowContextMenu:function(e,t,i){},onDblClickCell:function(e,t,i){}}),doServerMessage("listorderbuilds",{type:"refresh"}))}