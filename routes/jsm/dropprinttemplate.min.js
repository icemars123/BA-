exports.dropPrintTemplatePost=function(n,o){var f={message:"Error writing file"};if(__.isUndefined(n.body)||__.isNull(n.body))o.json({message:"No form to upload"});else if(__.isUndefined(n.files)||__.isUndefined(n.files.file))o.json({message:"No file to upload"});else{var s=__.isUndefined(n.body.printtemplateid)||"null"==n.body.printtemplateid?null:__.sanitiseAsBigInt(n.body.printtemplateid);__.isNull(s)?global.modconfig.newPrintTemplate({filename:n.files.file.originalFilename,uuid:n.body.uuid,description:n.body.description,mimetype:n.files.file.type,size:n.files.file.size},function(i,e){if(i)o.json(f);else{var l=global.path.join(__dirname,global.config.folders.printtemplates+e+"_"+n.files.file.originalFilename);global.copyFile(n.files.file.path,l,function(i){i?o.json(f):global.fs.unlink(n.files.file.path,function(){i||(f={id:e,filename:n.files.file.originalFilename}),o.json(f)})})}}):global.modconfig.savePrintTemplate({filename:n.files.file.originalFilename,printtemplateid:s,uuid:n.body.uuid,description:n.body.description,mimetype:n.files.file.type,size:n.files.file.size},function(i,e){if(i)o.json(f);else{var l=global.path.join(__dirname,global.config.folders.printtemplates+s+"_"+n.files.file.originalFilename);e=global.path.join(__dirname,global.config.folders.printtemplates+s+"_"+e);global.fs.unlink(e,function(i){i&&"ENOENT"!=i.code||global.fs.rename(n.files.file.path,l,function(i){i?o.json(f):global.fs.unlink(n.files.file.path,function(){i||(f={id:s,filename:n.files.file.originalFilename}),o.json(f)})})})}})}};