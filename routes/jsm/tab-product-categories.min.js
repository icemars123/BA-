var productcategoriesTabWidgetsLoaded=!1;function doCategoriesTabSearch(e,t){doSearchCodeNameInTree("divCategoriesTG",e)}function doProductCategoriesTabWidgets(){productcategoriesTabWidgetsLoaded||($("#divEvents").on("listproductcategories",function(e,t){$("#divCategoriesTG").treegrid("reload"),doExpandTreeToId("divCategoriesTG",t.pdata.productcategoryid)}),$("#divEvents").on("newproductcategory",function(e,t){primus.emit("listproductcategories",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh",productcategoryid:t.data.productcategoryid}})}),$("#divEvents").on("saveproductcategory",function(e,t){primus.emit("listproductcategories",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh",productcategoryid:t.data.productcategoryid}})}),$("#divEvents").on("changeproductcategoryparent",function(e,t){primus.emit("listproductcategories",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh",productcategoryid:t.data.productcategoryid}})}),$("#divEvents").on("expireproductcategory",function(e,t){primus.emit("listproductcategories",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),$("#divEvents").on("checkproductcategorycode",function(e,t){var o=t.data.rs;0<o.length&&doShowError("Product category code ["+o[0].code+"] is already assigned to ["+o[0].name+"]")}),$("#divEvents").on("categoriespopup",function(e,t){"newroot"==t?doDlgProductCategoryNew(null,null):"new"==t?doTreeGridGetSelectedRowData("divCategoriesTG",function(e){doDlgProductCategoryNew(e.id,null)}):"clear"==t?$("#divCategoriesTG").treegrid("unselectAll"):"edit"==t?doEdit():"cancel"==t?doCancel():"save"==t?doSave():"remove"==t?doTreeGridGetSelectedRowData("divCategoriesTG",function(t){doPromptYesNoCancel("Remove "+t.name+" and ALL subcategories (Yes) or ONLY this category (No)?",function(e){_.isNull(e)||primus.emit("expireproductcategory",{fguid:fguid,uuid:uuid,session:session,productcategoryid:t.id,cascade:e,pdata:{type:"refresh"}})})})||noty({text:"Please select a category to remove",type:"error",timeout:4e3}):"removeparent"==t&&doTreeGridGetSelectedRowData("divCategoriesTG",function(e){primus.emit("changeproductcategoryparent",{fguid:fguid,uuid:uuid,session:session,productcategoryid:e.id,parentid:null,pdata:{type:"changeproductcategoryparent"}})})}),productcategoriesTabWidgetsLoaded=!0,$("#divCategoriesTG").treegrid({idField:"id",treeField:"name",lines:!0,collapsible:!0,fitColumns:!0,autoRowHeight:!1,rownumbers:!0,striped:!0,toolbar:"#tbCategories",showFooter:!0,sortName:"name",sortOrder:"asc",remoteSort:!1,multiSort:!0,loader:function(e,t,o){t({total:cache_productcategories.length,rows:cache_productcategories}),$(this).treegrid("reloadFooter",[{name:'<span class="totals_footer">'+doGetCountTreeArray(cache_productcategories)+" Categories</span>"}])},columns:[[{title:"Name",field:"name",width:300,align:"left",resizable:!0,editor:"text",sortable:!0},{title:"Code",field:"code",width:200,align:"left",resizable:!0,editor:"text",sortable:!0},{title:"Modified",field:"date",width:150,align:"right",resizable:!0,sortable:!0},{title:"By",field:"by",width:200,align:"left",resizable:!0,sortable:!0}]],onContextMenu:function(e,t){doTreeGridContextMenu("divCategoriesTG","divCategoriesMenuPopup",e,t)},onLoadSuccess:function(e){$(this).treegrid("enableDnd")},onBeforeDrag:function(e){return!0},onDragOver:function(e,t){return!_.isUN(e)},onBeforeDrop:function(e,t,o){return!0},onDrop:function(e,t,o){var r=_.isUN(e)?null:e.id;doServerDataMessage("changeproductcategoryparent",{productcategoryid:t.id,parentid:r},{type:"refresh"})},onDblClickCell:function(e,t){doDlgProductCategoryNew(t.parentid,t.id)}}))}