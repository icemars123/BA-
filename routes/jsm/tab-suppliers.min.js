var suppliersTabWidgetsLoaded=!1;function doSuppliersSearch(e,i){doSearchCodeNameInTree("divSuppliersTG",e)}function doSuppliersShowActiveorAll(e){primus.emit("listsuppliers",{fguid:fguid,uuid:uuid,session:session,showinactive:!e,pdata:{type:"refresh"}})}function doSuppliersTabWidgets(){if(!suppliersTabWidgetsLoaded){suppliersTabWidgetsLoaded=!0;$("#divEvents").on("listsuppliers",function(e,i){$("#divSuppliersTG").treegrid("reload"),doExpandTreeToId("divSuppliersTG",i.pdata.supplierid)}),$("#divEvents").on("newsupplier",e),$("#divEvents").on("savesupplier",e),$("#divEvents").on("changesupplierparent",e),$("#divEvents").on("expiresupplier",e),$("#divEvents").on("suppliercreated",e),$("#divEvents").on("suppliersaved",e),$("#divEvents").on("supplierparentchanged",e),$("#divEvents").on("supplierexpired",e),$("#divEvents").on("saveclient",e),$("#divEvents").on("checksuppliercode",function(e,i){var r=i.data.rs;0<r.length&&doShowError("Supplier code ["+r[0].code+"] is already assigned to ["+r[0].name+"]")}),$("#divEvents").on("supplierspopup",function(e,i){"newroot"==i?doDlgSupplierNew(null,null):"new"==i?doTreeGridGetSelectedRowData("divSuppliersTG",function(e){doDlgSupplierNew(e.id,null)}):"clear"==i?$("#divSuppliersTG").treegrid("unselectAll"):"remove"==i?doTreeGridGetSelectedRowData("divSuppliersTG",function(i){doPromptYesNoCancel("Remove "+i.name+" and ALL subsuppliers (Yes) or ONLY this supplier (No)?",function(e){_.isNull(e)||primus.emit("expiresupplier",{fguid:fguid,uuid:uuid,session:session,supplierid:i.id,cascade:e,pdata:{type:"dosuppliersremove"}})})})||doShowError("Please select an employee to remove"):"removeparent"==i?doTreeGridGetSelectedRowData("divSuppliersTG",function(e){primus.emit("changesupplierparent",{fguid:fguid,uuid:uuid,session:session,supplierid:e.id,parentid:null,pdata:{type:"refresh"}})}):"notes"==i?doTreeGridGetSelectedRowData("divSuppliersTG",function(e){doDlgSupplierNotes(e)})||doShowError("Please select a supplier to view"):"attachments"==i&&(doTreeGridGetSelectedRowData("divSuppliersTG",function(e){doDlgSupplierAttachments(e)})||doShowError("Please select a supplier to view/edit attachments"))}),$("#divSuppliersTG").treegrid({idField:"id",treeField:"name",lines:!0,collapsible:!0,fitColumns:!1,autoRowHeight:!1,rownumbers:!0,striped:!0,toolbar:"#tbSuppliers",showFooter:!0,sortName:"name",sortOrder:"asc",remoteSort:!1,multiSort:!0,loader:function(e,i,r){i({total:cache_suppliers.length,rows:cache_suppliers}),$(this).treegrid("collapseAll",0),$(this).treegrid("reloadFooter",[{name:'<span class="totals_footer">'+doGetCountTreeArray(cache_suppliers)+" Suppliers</span>"}])},frozenColumns:[[{title:"Name",field:"name",width:300,align:"left",resizable:!0,sortable:!0},{title:"Code",field:"code",width:200,align:"left",resizable:!0,sortable:!0}]],columns:[[{title:"Active",field:"isactive",width:80,align:"center",resizable:!0,formatter:function(e,i){return mapBoolToImage(e)}},{title:"Modified",field:"date",width:150,align:"right",resizable:!0,sortable:!0},{title:"By",field:"by",width:200,align:"left",resizable:!0,sortable:!0}]],onContextMenu:function(e,i){doTreeGridContextMenu("divSuppliersTG","divSuppliersMenuPopup",e,i)},onLoadSuccess:function(e){$(this).treegrid("enableDnd")},onBeforeDrag:function(e){return!0},onDragOver:function(e,i){return!_.isUN(e)},onBeforeDrop:function(e,i,r){return!0},onDrop:function(e,i,r){var t=_.isUN(e)?null:e.id;doServerDataMessage("changesupplierparent",{supplierid:i.id,parentid:t},{type:"refresh"})},onDblClickCell:function(e,i){doDlgSupplierNew(i.parentid,i.id)}})}function e(e,i){primus.emit("listsuppliers",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh",supplierid:i.data.supplierid}})}}