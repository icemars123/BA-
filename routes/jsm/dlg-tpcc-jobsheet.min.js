var selectedJobSheetId=null;function doDlgJobSheet(p){var r={},s=0;function t(){var e,t,o,n,i,d,l,a,u=(e=0,d=i=n=o=t="",l=r.productcode,a=doSwitchButtonChecked("cbIsWide"),-1!=l.indexOf("02")?(t=a?(e=5,712):(e=1,305),o=213,i=n=390,d=6,s=.065):-1!=l.indexOf("03")?(t=a?(e=3,640):(e=1,230),o=313,i=n=360,d=5,s=.072):-1!=l.indexOf("04")?s=-1!=l.indexOf("S/W")||-1!=l.indexOf("SW")?(t=a?(e=5,730):(e=1,230),o=313,i=n=390,d=5,.078):(t=a?e=0:(e=1,200),o=215,i=n=375,d=6,.0625):-1!=l.indexOf("05")?(t=a?(e=3,790):(e=1,275),o=313,i=n=375,d=5,s=.075):-1!=l.indexOf("65")?(t=a?(e=4,790):(e=1,230),o=313,i=n=470,d=5,s=.094):-1!=l.indexOf("08")?-1!=l.indexOf("I/C")||-1!=l.indexOf("IC")?(t=a?e=0:(e=1,300),o=313,i=n=495,d=6,s=.0825):-1!=l.indexOf("08U")||-1!=l.indexOf("08UK")||-1!=l.indexOf("08K")?s=-1!=l.indexOf("S/W")||-1!=l.indexOf("SW")?(t=a?(e=3,730):(e=1,275),o=313,i=n=555,d=5,.111):(t=a?(e=3,760):(e=1,275),o=215,i=n=470,d=5,.094):-1==l.indexOf("08TK")&&-1==l.indexOf("08T")||(s=-1!=l.indexOf("S/W")||-1!=l.indexOf("SW")?(t=a?(e=3,675):(e=1,250),o=313,i=n=470,d=4,.1175):(t=a?(e=3,700):(e=1,250),o=215,i=n=470,d=5,.094)):-1!=l.indexOf("12")?s=-1!=l.indexOf("C/H")||-1!=l.indexOf("CH")?(t=a?e=0:(e=1,290),o=215,i=n=360,d=3,.12):-1!=l.indexOf("S/W")||-1!=l.indexOf("SW")?(t=a?(e=3,730):(e=1,275),o=313,i=n=555,d=4,.13875):(t=a?(e=3,760):(e=1,275),o=215,i=n=555,d=5,.111):-1!=l.indexOf("16")?s=-1!=l.indexOf("S/W")||-1!=l.indexOf("SW")?(t=a?(e=3,730):(e=1,275),o=313,i=n=480,d=3,.16):-1!=l.indexOf("D/W")||-1!=l.indexOf("DW")?(t=a?(e=3,760):(e=1,275),o=230,i=n=540,d=4,.135):(t=a?(e=2,690):(e=1,355),o=313,i=n=470,d=5,.094):-1!=l.indexOf("22")?(t=a?e=0:(e=1,300),o=213,i=n=540,d=3,s=.18):-1!=l.indexOf("24")&&(t=a?e=0:(e=1,300),o=213,i=n=615,d=3,s=.205),{iswide:a,across:e,reelwidth:t,thickness:o,gears:n,sleeves:i,around:d,factor:s});0==u.across?($("#fldReelWidth").numberbox("clear"),$("#fldThickness").numberbox("clear"),$("#fldGear").numberbox("clear"),$("#fldSleeveSize").numberbox("clear"),$("#cbNumAcross").combobox("clear"),$("#fldNumAround").numberbox("clear"),$("#fldPrintQuantity").numberbox("clear")):(printedqty=_.toBigNum(r.qtyordered).times(u.factor).div(u.across),$("#fldReelWidth").numberbox("setValue",u.reelwidth),$("#fldThickness").numberbox("setValue",u.thickness),$("#fldGear").numberbox("setValue",u.gears),$("#fldSleeveSize").numberbox("setValue",u.sleeves),$("#cbNumAcross").combobox("select",u.across),$("#fldNumAround").numberbox("setValue",u.around),$("#fldPrintQuantity").numberbox("setValue",printedqty))}function o(){_.isEmpty(r)?t():($("#fldOrderNo").textbox("setValue",r.orderno),$("#fldClientName").textbox("setValue",r.clientname),$("#fldPoNo").textbox("setValue",r.pono),$("#fldProductCode").textbox("setValue",r.productcode),$("#fldOrderQty").textbox("setValue",r.qtyordered),$("#fldUnit1Colour").textbox("setValue",r.txt1),$("#fldUnit1Anilox").numberbox("setValue",r.num1),$("#fldUnit2Colour").textbox("setValue",r.txt2),$("#fldUnit2Anilox").numberbox("setValue",r.num2),$("#fldUnit3Colour").textbox("setValue",r.txt3),$("#fldUnit3Anilox").numberbox("setValue",r.num3),$("#fldUnit4Colour").textbox("setValue",r.txt4),$("#fldUnit4Anilox").numberbox("setValue",r.num4),$("#fldUnit5Colour").textbox("setValue",r.txt5),$("#fldUnit5Anilox").numberbox("setValue",r.num5),$("#fldUnit6Colour").textbox("setValue",r.txt6),$("#fldUnit6Anilox").numberbox("setValue",r.num6),$("#fldReelWidth").numberbox("setValue",r.num7),$("#fldThickness").numberbox("setValue",r.num8),$("#fldGear").numberbox("setValue",r.num9),$("#fldSleeveSize").numberbox("setValue",r.num10),$("#cbNumAcross").combobox("setValue",r.num11),$("#fldNumAround").numberbox("setValue",r.num12),$("#fldPrintQuantity").numberbox("setValue",r.num13),$("#fldJobSheetComment").textbox("setValue",r.comments),$("#imgJobSheet").attr("src",r.imagename),doSetSwitchButton("cbIsWide",r.iswide),$("#dlgTPCCJobSheet").dialog("setTitle","Modify "+r.jobsheetno)),doTextboxFocus("fldUnit1Colour")}function e(e,t){$("#dlgTPCCJobSheet").dialog("close")}function n(e,t){_.isEmpty(r)||t.data.jobsheetno!=r.jobsheetno||(doShowWarning("This job has been removed from orders"),$("#dlgTPCCJobSheet").dialog("close"))}function i(e,t){r=t.data.jobsheet,doServerDataMessage("tpcclistjobsheetdetails",{jobsheetid:p},{type:"refresh"}),o()}function d(e,t){$("#divJobSheetDetailsG").datagrid("loadData",t.data.rs)}function l(e,t){t.data.jobsheetid==p&&doServerDataMessage("tpcclistjobsheetdetails",{jobsheetid:p},{type:"refresh"})}function a(e,t){$("#imgJobSheet").attr("src",t.data.imagename)}$("#divEvents").on("tpccloadjobsheet",i),$("#divEvents").on("tpccsavejobsheet",e),$("#divEvents").on("tpccjobsheetimagecreated",a),$("#divEvents").on("tpcclistjobsheetdetails",d),$("#divEvents").on("tpccjobsheetdetailadded",l),$("#divEvents").on("tpccjobsheetexpired",n),$("#dlgTPCCJobSheet").dialog({onClose:function(){$("#divEvents").off("tpccloadjobsheet",i),$("#divEvents").off("tpccsavejobsheet",e),$("#divEvents").off("tpccjobsheetimagecreated",a),$("#divEvents").off("tpcclistjobsheetdetails",d),$("#divEvents").off("tpccjobsheetdetailadded",l),$("#divEvents").off("tpccjobsheetexpired",n)},onOpen:function(){selectedJobSheetId=p,$("#cbNumAcross").combobox({valueField:"id",textField:"name",limitToList:!0,data:int_to_5,onSelect:function(e){t()}}),$("#cbIsWide").switchbutton({checked:!1,onChange:function(e){t()}}),$("#divJobSheetDetailsG").datagrid({idField:"id",fitColumns:!0,rownumbers:!0,striped:!0,columns:[[{title:"Type",field:"itype",width:120,align:"left",resizable:!0,formatter:function(e,t){return doGetStringFromIdInObjArray(js_types,e)}},{title:"Batch No.",field:"batchno",width:150,align:"left",resizable:!0},{title:"Value 1",field:"num1",width:80,align:"right",resizable:!0,formatter:function(e,t,o){return _.isUndefined(t.id)?e:_.niceformatqty(e,0)}},{title:"Value 2",field:"num2",width:80,align:"right",resizable:!0,formatter:function(e,t,o){return _.isUndefined(t.id)?e:_.niceformatqty(e,0)}},{title:"Created",field:"datecreated",width:180,align:"right",resizable:!0,sortable:!0},{title:"By",field:"usercreated",width:200,align:"left",resizable:!0,sortable:!0}]]}),_.isNull(p)?o():doServerDataMessage("tpccloadjobsheet",{jobsheetid:p},{type:"refresh"})},buttons:[{text:"Begin",handler:function(){doServerDataMessage("tpccbeginjob",{jobsheetid:p},{type:"refresh"})}},{text:"Complete",handler:function(){doServerDataMessage("tpcccompletejob",{jobsheetid:p},{type:"refresh"})}},{text:"Save",handler:function(){var e=$("#fldUnit1Colour").textbox("getValue"),t=$("#fldUnit1Anilox").numberbox("getValue"),o=$("#fldUnit2Colour").textbox("getValue"),n=$("#fldUnit2Anilox").numberbox("getValue"),i=$("#fldUnit3Colour").textbox("getValue"),d=$("#fldUnit3Anilox").numberbox("getValue"),l=$("#fldUnit4Colour").textbox("getValue"),a=$("#fldUnit4Anilox").numberbox("getValue"),u=$("#fldUnit5Colour").textbox("getValue"),r=$("#fldUnit5Anilox").numberbox("getValue"),s=$("#fldUnit6Colour").textbox("getValue"),b=$("#fldUnit6Anilox").numberbox("getValue"),f=$("#fldReelWidth").numberbox("getValue"),x=$("#fldThickness").numberbox("getValue"),c=$("#fldGear").numberbox("getValue"),m=$("#fldSleeveSize").numberbox("getValue"),h=$("#cbNumAcross").combobox("getValue"),g=$("#fldNumAround").numberbox("getValue"),V=$("#fldPrintQuantity").numberbox("getValue"),v=$("#fldJobSheetComment").textbox("getValue"),S=doSwitchButtonChecked("cbIsWide")?1:0;doServerDataMessage("tpccsavejobsheet",{jobsheetid:p,num1:t,num2:n,num3:d,num4:a,num5:r,num6:b,num7:f,num8:x,num9:c,num10:m,num11:h,num12:g,num13:V,txt1:e,txt2:o,txt3:i,txt4:l,txt5:u,txt6:s,comment:v,iswide:S},{type:"refresh"})}},{text:"Reset",handler:function(){o()}},{text:"Close",handler:function(){$("#dlgTPCCJobSheet").dialog("close")}}]}).dialog("center").dialog("open")}