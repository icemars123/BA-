function doDlgProductSelect(d,e,r,u){var t=[];function o(e,t){var o=$("#cbProductSelectProducts").combobox("getValue");if(t.data.productid==o){var c=$("#fldProductSelectQty").numberbox("getValue");doServerDataMessage("getprice",{clientid:d,productid:o,qty:c},{type:"refresh"})}}function c(e,t){if(r)$("#fldProductSelectPrice").numberbox("setValue",t.data.price.costprice);else{var o=$("#fldProductSelectQty").numberbox("getValue");if(!_.isNull(t.data.price.minqty)){var c=_.toBigNum(t.data.price.minqty);(_.isBlank(o)||c.greaterThan(o))&&$("#fldProductSelectQty").numberbox("setValue",t.data.price.minqty)}$("#fldProductSelectPrice").numberbox("setValue",t.data.price.unitprice)}}function i(e,t){"new"==t?doNew():"edit"==t?doEdit():"remove"==t&&doRemove()}$("#divEvents").off("productpricingupdated",o).on("productpricingupdated",o),$("#divEvents").off("getprice",c).on("getprice",c),$("#divEvents").off("productpricespopup",i).on("productpricespopup",i),cache_products.forEach(function(e){(_.isNull(e.clientid)||e.clientid==d)&&t.push({id:e.id,code:e.code,productcategoryname:e.productcategoryname})}),$("#dlgProductSelect").dialog({onClose:function(){},onOpen:function(){$("#cbProductSelectProducts").combobox({valueField:"id",textField:"code",groupField:"productcategoryname",data:t,limitToList:!0,onSelect:function(e){var t=$("#fldProductSelectQty").numberbox("getValue");primus.emit("getprice",{fguid:fguid,uuid:uuid,session:session,clientid:d,productid:e.id,qty:t,pdata:{type:"refresh"}}),doTextboxFocus("fldProductSelectQty")}}),$("#fldProductSelectQty").numberbox($.extend(numberboxParseObj,{onChange:function(e,t){var o=$("#cbProductSelectProducts").combobox("getValue");_.isBlank(o)||primus.emit("getprice",{fguid:fguid,uuid:uuid,session:session,clientid:d,productid:o,qty:e,pdata:{type:"refresh"}})}})),$("#fldProductSelectPrice").numberbox({disabled:!e}),$("#cbProductSelectIsRepeat").switchbutton({onText:"Repeat",offText:"New",checked:!1}),$("#cbProductSelectIsNewArtwork").switchbutton({onText:"Yes",offText:"No",checked:!1}),$("#cbProductSelectProducts").combobox("loadData",t),doProductSelectReset()},buttons:[{text:"Select",handler:function(){var e=$("#cbProductSelectProducts").combobox("getValue"),t=$("#cbProductSelectProducts").combobox("getText"),o=$("#fldProductSelectQty").numberbox("getValue"),c=$("#fldProductSelectPrice").numberbox("getValue");isrepeat=doSwitchButtonChecked("cbProductSelectIsRepeat"),isnewartwork=doSwitchButtonChecked("cbProductSelectIsNewArtwork"),_.isBlank(e)?doMandatoryTextbox("Please select a product...","cbProductSelectProducts"):_.isBlank(o)||_.toBigNum(o).lessThanOrEqualTo(0)?doMandatoryTextbox("Please enter a non-zero quantity...","fldProductSelectQty"):(u&&u(e,t,o,c,isrepeat,isnewartwork),$("#dlgProductSelect").dialog("close"))}},{text:"Reset",handler:function(){doProductSelectReset()}},{text:"Close",handler:function(){$("#dlgProductSelect").dialog("close")}}]}).dialog("center").dialog("open")}function doProductSelectReset(){$("#cbProductSelectProducts").combobox("clear"),$("#fldProductSelectQty").numberbox("clear"),$("#fldProductSelectPrice").numberbox("clear"),doTextboxFocus("cbProductSelectProducts")}