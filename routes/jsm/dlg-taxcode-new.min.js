function doDlgTaxCodeNew(o){var t=_.isUndefined(o)||_.isNull(o),a={};function n(){t?($("#fldNewTaxCodeName").textbox("clear"),$("#fldNewTaxCodeCode").textbox("clear"),$("#fldNewTaxCodePercent").numberbox("clear"),$("#btnTaxCodeNewAdd").linkbutton("disable")):_.isEmpty(a)||($("#fldNewTaxCodeName").textbox("setValue",a.name),$("#fldNewTaxCodeCode").textbox("setValue",a.code),$("#fldNewTaxCodePercent").numberbox("setValue",a.percent),$("#btnTaxCodeNewAdd").linkbutton("enable"),$("#dlgTaxCodeNew").dialog("setTitle","Modify "+a.name)),doTextboxFocus("fldNewTaxCodeName")}function e(e,d){0<d.data.rs.length?$("#btnTaxCodeNewAdd").linkbutton("disable"):$("#btnTaxCodeNewAdd").linkbutton("enable")}function d(e,d){$("#dlgTaxCodeNew").dialog("close")}function x(e,d){a=d.data.taxcode,n()}$("#divEvents").on("checktaxcode",e),$("#divEvents").on("newtaxcode",d),$("#divEvents").on("savetaxcode",d),$("#divEvents").on("loadtaxcode",x),$("#divEvents").on("checktaxcode",function(e,d){var o=d.data.rs;0<o.length&&doShowError("Tax code ["+o[0].code+"] is already assigned to ["+o[0].name+"]")}),$("#dlgTaxCodeNew").dialog({onClose:function(){$("#divEvents").off("checktaxcode",e),$("#divEvents").off("newtaxcode",d),$("#divEvents").off("savetaxcode",d),$("#divEvents").off("loadtaxcode",x)},onOpen:function(){$("#fldNewTaxCodeCode").textbox({onChange:function(e,d){_.isBlank(e)?$("#btnTaxCodeNewAdd").linkbutton("disable"):e!=d&&doServerDataMessage("checktaxcode",{taxcodeid:o,code:e},{type:"refresh"})}}),t?$("#btnTaxCodeNewAdd").linkbutton({text:"Add"}):$("#btnTaxCodeNewAdd").linkbutton({text:"Save"}),_.isNull(o)?n():doServerDataMessage("loadtaxcode",{taxcodeid:o},{type:"refresh"})},buttons:[{text:"Add",disabled:!0,id:"btnTaxCodeNewAdd",handler:function(){var e=$("#fldNewTaxCodeName").textbox("getValue"),d=$("#fldNewTaxCodeCode").textbox("getValue"),o=$("#fldNewTaxCodePercent").numberbox("getValue");_.isBlank(e)?doMandatoryTextbox("Please enter name of tax code","fldNewTaxCodeName"):_.isBlank(d)?doMandatoryTextbox("Please enter unique tax code","fldNewTaxCodeCode"):_.isBlank(o)?doMandatoryTextbox("Please enter percentage tax","fldNewTaxCodePercent"):t?doServerDataMessage("newtaxcode",{name:e,code:d,percent:o},{type:"refresh"}):doServerDataMessage("savetaxcode",{taxcodeid:a.id,name:e,code:d,percent:o},{type:"refresh"})}},{text:"Reset",handler:function(){n()}},{text:"Close",handler:function(){$("#dlgTaxCodeNew").dialog("close")}}]}).dialog("center").dialog("open")}