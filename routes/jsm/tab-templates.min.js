var templatesTabWidgetsLoaded=!1,selectedPrintTemplateId=null;function doPrintTemplatesTabSearch(e,t){for(var i=e.toUpperCase(),d=0;d<cache_printtemplates.length;d++){var n=cache_printtemplates[d].description.toUpperCase();t=cache_printtemplates[d].name.toUpperCase();if(-1<n.indexOf(i)||-1<t.indexOf(i)){var a=cache_printtemplates[d].id,r=$("#divPrintTemplatesG").datagrid("getRowIndex",a);$("#divPrintTemplatesG").datagrid("selectRow",r);break}}}function doTemplatesTabWidgets(){var d=null;function e(){primus.emit("listprinttemplates",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}templatesTabWidgetsLoaded||($("#divEvents").on("listprinttemplates",function(e,t){$("#divPrintTemplatesG").datagrid("reload"),_.isUndefined(t.pdata.printtemplateid)||_.isNull(t.pdata.printtemplateid)||$("#divPrintTemplatesG").datagrid("selectRecord",t.pdata.printtemplateid)}),$("#divEvents").on("saveprinttemplate",e),$("#divEvents").on("expireprinttemplate",e),$("#divEvents").on("printtemplatecreated",e),$("#divEvents").on("printtemplatesaved",e),$("#divEvents").on("printtemplateexpired",e),$("#divEvents").on("printtemplatespopup",function(e,t){"clear"==t?($("#divPrintTemplatesG").datagrid("clearSelections"),selectedPrintTemplateId=null):"edit"==t?doGridStartEdit("divPrintTemplatesG",d,function(e,t){d=t,doGridGetEditor("divPrintTemplatesG",d,"name",function(e){})}):"cancel"==t?d=doGridCancelEdit("divPrintTemplatesG",d):"save"==t?(doGridEndEditGetRow("divPrintTemplatesG",d,function(e){primus.emit("saveprinttemplate",{fguid:fguid,uuid:uuid,session:session,printtemplateid:e.id,description:e.description,pdata:{type:"refresh"}})}),d=null):"remove"==t&&(doGridGetSelectedRowData("divPrintTemplatesG",function(t){doPromptOkCancel("Remove template "+t.description+"?",function(e){e&&primus.emit("expireprinttemplate",{fguid:fguid,uuid:uuid,session:session,printtemplateid:t.id,pdata:{type:"refresh"}})})})||noty({text:"Please select a template to remove",type:"error",timeout:4e3}))}),templatesTabWidgetsLoaded=!0,$("#divPrintTemplatesG").datagrid({idField:"id",fitColumns:!1,singleSelect:!0,rownumbers:!0,striped:!0,toolbar:"#tbPrintTemplates",loader:function(e,t,i){t({total:cache_printtemplates.length,rows:cache_printtemplates})},columns:[[{title:"Name",field:"name",width:200,align:"left",resizable:!0},{title:"Description",field:"description",width:300,align:"left",resizable:!0,editor:"text"},{title:"Type",field:"mimetype",width:100,align:"center",resizable:!0},{title:"Size",field:"size",width:150,align:"right",resizable:!0,formatter:function(e,t,i){if(!_.isUndefined(e))return filesize(e,{base:10})}},{title:"Modified",field:"date",width:150,align:"right",resizable:!0},{title:"By",field:"by",width:200,align:"left",resizable:!0}]],onRowContextMenu:function(e,t,i){doGridContextMenu("divPrintTemplatesG","divPrintTemplatesMenuPopup",e,t,i)},onClickRow:function(e,t){selectedPrintTemplateId=t.id},onDblClickCell:function(e,t,i){doGridStartEdit("divPrintTemplatesG",d,function(e,t){d=t,doGridGetEditor("divPrintTemplatesG",d,"description",function(e){})})}}))}