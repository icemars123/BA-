var usersTabWidgetsLoaded=!1;function doUsersTabSearch(e,t){doSearchCodeNameInGrid("divUsersG",e,"username","uuid")}function doUsersTabWidgets(){function e(e,t){doServerMessage("listusers",{type:"refresh",uuid:t.data.uuid})}usersTabWidgetsLoaded||($("#divEvents").on("listusers",function(e,t){$("#divUsersG").datagrid("reload"),_.isUndefined(t.pdata.uuid)||_.isNull(t.pdata.uuid)||$("#divUsersG").datagrid("selectRecord",t.pdata.uuid)}),$("#divEvents").on("listconnectedusers",function(e,t){t.data.rs.forEach(function(e){var t=$("#divUsersG").datagrid("getRowIndex",e.uuid);-1!=t&&$("#divUsersG").datagrid("updateRow",{index:t,row:{status:mapUserStatusToImage("online")}})})}),$("#divEvents").on("newuser",e),$("#divEvents").on("saveuser",e),$("#divEvents").on("expireuser",e),$("#divEvents").on("changepassword",e),$("#divEvents").on("userpermissionssaved",e),$("#divEvents").on("useronline",function(e,t){doGetGridFindId("divUsersG",t.data.uuid,function(e,t){e||$("#divUsersG").datagrid("updateRow",{index:t,row:{status:mapUserStatusToImage("online")}})})}),$("#divEvents").on("useroffline",function(e,t){doGetGridFindId("divUsersG",t.data.uuid,function(e,t){e||$("#divUsersG").datagrid("updateRow",{index:t,row:{status:mapUserStatusToImage("offline")}})})}),$("#divEvents").on("userlogout",function(e,t){doGetGridFindId("divUsersG",t.data.uuid,function(e,t){e||$("#divUsersG").datagrid("updateRow",{index:t,row:{status:mapUserStatusToImage("logout")}})})}),$("#divEvents").on("userpaused",function(e,t){doGetGridFindId("divUsersG",t.data.uuid,function(e,t){e||$("#divUsersG").datagrid("updateRow",{index:t,row:{status:mapUserStatusToImage("paused")}})})}),$("#divEvents").on("userpolled",function(e,t){doGetGridFindId("divUsersG",t.data.uuid,function(e,t){e||$("#divUsersG").datagrid("updateRow",{index:t,row:{status:mapUserStatusToImage("polled")}})})}),$("#divEvents").on("userspopup",function(e,t){"new"==t?doDlgUserNew(null):"clear"==t?$("#divUsersG").datagrid("clearSelections"):"remove"==t?doGridGetSelectedRowData("divUsersG",function(t){doPromptOkCancel("Remove "+t.name+"?",function(e){e&&doServerDataMessage("expireuser",{useruuid:t.uuid},{type:"refresh"})})})||doShowError("Please select a superfund to remove"):"password"==t?doGridGetSelectedRowData("divUsersG",function(e){doDlgChangePassword(e)})||doShowError("Please select a user to change password"):"permissions"==t&&(doGridGetSelectedRowData("divUsersG",function(e){doDlgUserPermissions(e)})||doShowError("Please select a user to view/edit permissions"))}),usersTabWidgetsLoaded=!0,isadmin||$("#tbUsersNew").remove(),$("#divUsersG").datagrid({idField:"uuid",fitColumns:!1,singleSelect:!0,rownumbers:!0,striped:!0,toolbar:"#tbUsers",showFooter:!0,sortName:"name",sortOrder:"asc",remoteSort:!1,multiSort:!0,loader:function(e,t,i){t({total:cache_users.length,rows:cache_users}),$(this).datagrid("reloadFooter",[{name:'<span class="totals_footer">'+cache_users.length+" Users</span>"}]),doServerMessage("listconnectedusers",{type:"refresh"})},frozenColumns:[[{title:"Status",rowspan:2,field:"status",width:80,align:"center",resizable:!0},{title:"Name",rowspan:2,field:"name",width:300,align:"left",resizable:!0,editor:"text",styler:function(e,t,i){if(t.isclient)return"color: "+colour_blueviolet},sortable:!0}],[]],columns:[[{title:"User Name",rowspan:2,field:"username",width:300,align:"left",resizable:!0,sortable:!0},{title:"Email",rowspan:2,field:"email",width:300,align:"left",resizable:!0},{title:"Phone",rowspan:2,field:"phone",width:150,align:"left",resizable:!0},{title:"Admin?",rowspan:2,field:"isadmin",width:80,align:"center",resizable:!0,formatter:function(e,t){return mapBoolToImage(e)}},{title:"Client?",rowspan:2,field:"isclient",width:80,align:"center",resizable:!0,formatter:function(e,t){return mapBoolToImage(e)}},{title:"Client",rowspan:2,field:"clientid",width:300,align:"left",resizable:!0,formatter:function(e,t){return doGetNameFromTreeArray(cache_clients,e)},styler:function(e,t,i){if(t.isclient)return"color: "+colour_blueviolet},sortable:!0},{title:"Avatar",rowspan:2,field:"avatar",width:100,align:"center",resizable:!0,formatter:function(e,t){return mapAvatarToImage(e)}},{title:"Last",colspan:3},{title:"Modified",rowspan:2,field:"date",width:150,align:"right",resizable:!0,sortable:!0},{title:"By",rowspan:2,field:"by",width:200,align:"left",resizable:!0,sortable:!0}],[{title:"Login",field:"lastlogin",width:150,align:"right",resizable:!0,sortable:!0},{title:"Logout",field:"lastlogout",width:150,align:"right",resizable:!0,sortable:!0},{title:"IP",field:"lastip",width:150,align:"left",resizable:!0,sortable:!0}]],onRowContextMenu:function(e,t,i){doGridContextMenu("divUsersG","divUsersMenuPopup",e,t,i)},onDblClickCell:function(e,t,i){doGetGridGetRowDataByIndex("divUsersG",e,function(e){doDlgUserNew(e.uuid)})}}))}