function doDlgRepOrdersLocations(){var r=null,a=[];function e(e,o){if(0<o.data.rs.length){if(_.isNull(r))return;r.removeMarkers(),doShowSuccess("Found "+o.data.rs.length+" orders"),o.data.rs.forEach(function(e,o){if(!_.isUndefined(e.fqaddress)){var t="<strong>Client:</strong> "+doNiceTitleizeString(e.clientname)+"<br/><strong>Order No.:</strong> "+doNiceUppercaseString(e.orderno)+'<br/><strong>Date:</strong> <span style="color: '+colour_royalblue+'">'+_.friendlydisplaydate(e.datecreated)+"</span><br/><strong>Address:</strong> "+doNiceComments(e.fqaddress);a.push({html:t,marker:r.addMarker({lat:e.gpslat,lng:e.gpslon,icon:"images/pinCupBrown.png",title:"Order: "+e.orderno,infoWindow:{content:t}})}),0==o&&(r.panTo({lat:parseFloat(e.gpslat),lng:parseFloat(e.gpslon)}),a[0].marker.infoWindow.open(r,a[0].marker))}})}}$("#divEvents").on("report-orderslocations",e),$("#dlgRepOrdersLocations").dialog({onClose:function(){a=r=null,tiles=null,$("#divEvents").off("report-orderslocations",e)},onOpen:function(){$("#dtRepOrdersLocationsDateFrom").datebox(),$("#dtRepOrdersLocationsDateTo").datebox(),r=new GMaps({el:"#mapOrdersLocations",lat:tpccgpslat,lng:tpccgpslon,zoom:11,zoomControl:!0,zoomControlOpt:{style:"SMALL",position:"TOP_LEFT"},mapTypeId:google.maps.MapTypeId.ROADMAP,panControl:!1,streetViewControl:!1,mapTypeControl:!1,navigationControl:!0,scrollwheel:!0,overviewMapControl:!1,markerClusterer:function(e){var o=new MarkerClusterer(e);return o.setMaxZoom(maxZoom),o}}),doTextboxFocus("dtRepOrdersLocationsDateFrom")},buttons:[{text:"Run",handler:function(){var e=$("#dtRepOrdersLocationsDateFrom").datebox("getValue"),o=$("#dtRepOrdersLocationsDateTo").datebox("getValue"),t=moment();if(_.isBlank(e)&&_.isBlank(o))doMandatoryTextbox("Please select a start and end date for the report","dtRepOrdersLocationsDateFrom");else{if(_.isBlank(o)){if(moment(e).isAfter(t))return void doMandatoryTextbox("Start date can not be after today...","dtRepOrdersLocationsDateFrom");o=t.format("YYYY-MM-DD hh:mm:ss")}if(_.isBlank(e)){if(moment(o).isBefore(t))return void doMandatoryTextbox("End date can not be before today...","dtRepOrdersLocationsDateTo");e=t.format("YYYY-MM-DD hh:mm:ss")}doServerDataMessage("report",{report:"orderslocations",datefrom:e,dateto:o},{type:"refresh"})}}},{text:"Reset",handler:function(){$("#dtRepOrdersLocationsDateFrom").datebox("clear"),$("#dtRepOrdersLocationsDateTo").datebox("clear"),_.isNull(r)||(r.removeMarkers(),a=[])}},{text:"Close",handler:function(){$("#dlgRepOrdersLocations").dialog("close")}}]}).dialog("center").dialog("open")}