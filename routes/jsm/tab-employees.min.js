var employeesTabWidgetsLoaded=!1;function doEmployeesTabSearch(e,o){doSearchCodeNameInTree("divEmployeesTG",e)}function doEmployeesTabWidgets(){function e(e,o){doServerMessage("listemployees",{type:"refresh",employeeid:o.data.employeeid})}employeesTabWidgetsLoaded||(employeesTabWidgetsLoaded=!0,$("#divEvents").on("listemployees",function(e,o){$("#divEmployeesTG").treegrid("reload"),doExpandTreeToId("divEmployeesTG",o.pdata.employeeid)}),$("#divEvents").on("newemployee",e),$("#divEvents").on("saveemployee",e),$("#divEvents").on("expireemployee",e),$("#divEvents").on("changeemployeeparent",e),$("#divEvents").on("checkemployeecode",function(e,o){var t=o.data.rs;0<t.length&&doShowError("Employee code ["+t[0].code+"] is already assigned to ["+t[0].name+"]")}),$("#divEvents").on("employeespopup",function(e,o){"newroot"==o?doDlgEmployeeNew(null,null):"new"==o?doTreeGridGetSelectedRowData("divEmployeesTG",function(e){doDlgEmployeeNew(e.id,null)}):"clear"==o?$("#divEmployeesTG").treegrid("unselectAll"):"remove"==o?doTreeGridGetSelectedRowData("divEmployeesTG",function(o){doPromptYesNoCancel("Remove "+o.firstname+" "+o.lastname+" and ALL subemployees (Yes) or ONLY this employee (No)?",function(e){_.isNull(e)||doServerDataMessage("expireemployee",{employeeid:o.id,cascade:e},{type:"refresh"})})})||doShowError("Please select an employee to remove"):"removeparent"==o&&doTreeGridGetSelectedRowData("divEmployeesTG",function(e){doServerDataMessage("changeemployeeparent",{employeeid:e.id,parentid:null},{type:"refresh"})})}),$("#divEmployeesTG").treegrid({idField:"id",treeField:"lastname",lines:!0,collapsible:!0,fitColumns:!1,autoRowHeight:!1,rownumbers:!0,striped:!0,toolbar:"#tbEmployees",showFooter:!0,sortName:"lastname",sortOrder:"asc",remoteSort:!1,multiSort:!0,loader:function(e,o,t){o({total:cache_employees.length,rows:cache_employees}),$(this).treegrid("reloadFooter",[{lastname:'<span class="totals_footer">'+doGetCountTreeArray(cache_employees)+" Employees</span>"}])},frozenColumns:[[{title:"Last Name",field:"lastname",width:150,align:"left",resizable:!0,editor:"text",sortable:!0},{title:"First Name",field:"firstname",width:150,align:"left",resizable:!0,editor:"text",sortable:!0}]],columns:[[{title:"Code",field:"code",width:200,align:"left",resizable:!0,sortable:!0},{title:"Alt Code",field:"altcode",width:200,align:"left",resizable:!0,sortable:!0},{title:"Female?",field:"gender",width:80,align:"center",resizable:!0,formatter:function(e,o){return mapBoolToImage(e)}},{title:"Email",field:"email1",width:200,align:"left",resizable:!0},{title:"Phone",field:"phone1",width:200,align:"left",resizable:!0},{title:"Modified",field:"date",width:150,align:"right",resizable:!0,sortable:!0},{title:"By",field:"by",width:200,align:"left",resizable:!0,sortable:!0}]],onContextMenu:function(e,o){doTreeGridContextMenu("divEmployeesTG","divEmployeesMenuPopup",e,o)},onLoadSuccess:function(e){$(this).treegrid("enableDnd")},onClickRow:function(e){},onBeforeDrag:function(e){return!0},onDragOver:function(e,o){return!_.isUN(e)},onBeforeDrop:function(e,o,t){return!0},onDrop:function(e,o,t){var l=_.isUN(e)?null:e.id;doServerDataMessage("changeemployeeparent",{employeeid:o.id,parentid:l},{type:"refresh"})},onDblClickCell:function(e,o){doDlgEmployeeNew(o.parentid,o.id)}}))}