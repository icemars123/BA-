function doDlgAccountNew(e,c){var n=_.isUndefined(c)||_.isNull(c),a={};function o(){$("#cbNewAccountParent").combotree("setValue",e),n?($("#cbNewAccountType").combobox("clear"),$("#fldNewAccountName").textbox("clear"),$("#fldNewAccountCode").textbox("clear"),$("#btnAccountNewAdd").linkbutton("disable")):_.isEmpty(a)||($("#cbNewAccountType").combobox("setValue",a.itype),$("#fldNewAccountName").textbox("setValue",a.name),$("#fldNewAccountCode").textbox("setValue",a.code),$("#btnAccountNewAdd").linkbutton("enable"),$("#dlgAccountNew").dialog("setTitle","Modify "+a.name)),doTextboxFocus("fldNewAccountName")}function t(e,t){$("#dlgAccountNew").dialog("close")}function d(e,t){$("#cbNewAccountParent").combotree("loadData",cache_accounts)}function u(e,t){0<t.data.rs.length?$("#btnAccountNewAdd").linkbutton("disable"):$("#btnAccountNewAdd").linkbutton("enable")}function l(e,t){a=t.data.account,o()}$("#divEvents").on("newaccount",t),$("#divEvents").on("saveaccount",t),$("#divEvents").on("checkaccountcode",u),$("#divEvents").on("listaccounts",d),$("#divEvents").on("loadaccount",l),$("#dlgAccountNew").dialog({onClose:function(){$("#divEvents").off("newaccount",t),$("#divEvents").off("saveaccount",t),$("#divEvents").off("checkaccountcode",u),$("#divEvents").off("listaccounts",d),$("#divEvents").off("loadaccount",l)},onOpen:function(){$("#cbNewAccountParent").combotree({valueField:"id",textField:"name",data:cache_accounts}),$("#cbNewAccountType").combobox({valueField:"id",textField:"name",data:accounttypes}),$("#fldNewAccountCode").textbox({onChange:function(e,t){_.isBlank(e)?$("#btnAccountNewAdd").linkbutton("disable"):e!=t&&doServerDataMessage("checkaccountcode",{accountid:c,code:e},{type:"refresh"})}}),n?$("#btnAccountNewAdd").linkbutton({text:"Add"}):$("#btnAccountNewAdd").linkbutton({text:"Save"}),_.isNull(c)?o():doServerDataMessage("loadaccount",{accountid:c},{type:"refresh"})},buttons:[{text:"Add",disabled:!0,id:"btnAccountNewAdd",handler:function(){var e=doGetComboTreeSelectedId("cbNewAccountParent"),t=$("#fldNewAccountName").textbox("getValue"),c=$("#fldNewAccountCode").textbox("getValue"),o=$("#cbNewAccountType").combobox("getValue");_.isBlank(t)?doMandatoryTextbox("Please enter an account name","fldNewAccountName"):_.isBlank(c)?doMandatoryTextbox("Please enter a unique account code","fldNewAccountCode"):_.isBlank(o)?doMandatoryTextbox("Please select an acocunt type","cbNewAccountType"):n?doServerDataMessage("newaccount",{parentid:e,name:t,code:c,accounttype:o},{type:"refresh"}):doServerDataMessage("saveaccount",{accountid:a.id,parentid:e,name:t,code:c,accounttype:o,altcode:a.altcode,altname:a.altname},{type:"refresh"})}},{text:"Reset",handler:function(){o()}},{text:"Close",handler:function(){$("#dlgAccountNew").dialog("close")}}]}).dialog("center").dialog("open")}