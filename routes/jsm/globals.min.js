var server=self.location.protocol+"://"+self.location.hostname+":"+self.location.port,geocoder=null,primus=null,firstconnection=!0,connected=!1,fguid="",uid="",uname="",uuid="",session="",isadmin=0,isclient=0,ispos=!1,cmdcentre=null,myperms={canvieworders:0,cancreateorders:0,canviewinvoices:0,cancreateinvoices:0,canviewinventory:0,cancreateinventory:0,canviewpayroll:0,cancreatepayroll:0,canviewproducts:0,cancreateproducts:0,canviewclients:0,cancreateclients:0,canviewcodes:0,cancreatecodes:0,canviewclients:0,cancreateclients:0,canviewusers:0,cancreateusers:0,canviewbuilds:0,cancreatebuilds:0,canviewtemplates:0,cancreatetemplates:0,canviewbanking:0,cancreatebanking:0,canviewpurchasing:0,cancreatepurchasing:0,canviewalerts:0,cancreatealerts:0,canviewdashboard:0,cancreatedashboard:0},tabs=null,graph=null,channels=[],inittasks=0,completedtasks=0,importtype="",tpccgpslat="-37.749451",tpccgpslon="145.030579",tpccorgid=5183,maxZoom=14,css_gridcol_batchno_expired="color: red; font-weight: bold;",css_gridcol_batchno="color: blue;",css_gridcol_qty_neg="color: red;",css_gridcol_client_price="color: blue; font-weight: bold;",uomtypes=["Bottle","Carton","Box","Palette","bbl","doz","floz","gal","kg","g","l","lb","m3","mg","mt","oz","ml","t"],accounttypes=[{name:"Assets",id:1},{name:"Expenses",id:2},{name:"Liabilities",id:3},{name:"Equities",id:4},{name:"Income",id:5},{name:"Cost of Goods Sold",id:6},{name:"Other Income",id:7},{name:"Other Expenses",id:8},{name:"Bank",id:99}],tstypes=[{name:"Base Pay",id:1},{name:"Overtime 1",id:2},{name:"Overtime 2",id:3},{name:"Overtime 3",id:4},{name:"Leave - Annual",id:5},{name:"Leave - Sick & Carers",id:6},{name:"Leave - Compassionate",id:7},{name:"Leave - Long Service",id:8},{name:"Leave - Maternity & Parental",id:9},{name:"Leave - Worker's Compensation",id:10},{name:"Leave - Community Service",id:11},{name:"Public Holiday",id:12},{name:"Other",id:13}],taxtabletypes=[{name:"Tax Free Threshold",id:1},{name:"No Tax Free Threshold",id:2}],inventorytypes=[{name:"Transfer",id:1},{name:"Adjustment",id:2},{name:"Order",id:3},{name:"Stock",id:4},{name:"Build",id:5},{name:"P.O.",id:6}],payrates=[{name:"Hourly",id:1},{name:"Daily",id:2},{name:"Weekly",id:3},{name:"Fortnightly",id:4},{name:"Monthly",id:5},{name:"Annual",id:6}],payfrequencies=[{name:"Weekly",id:1},{name:"Fortnightly",id:2},{name:"Monthly",id:3}],employmenttypes=[{name:"Full Time",id:1},{name:"Part Time",id:2},{name:"Casual",id:3},{name:"Fixed Term",id:4},{name:"Contract",id:5},{name:"Apprentice",id:6}],employmentstatuses=[{name:"Employed",id:1},{name:"Suspended",id:2},{name:"Leave",id:3}],paymenttypes=[{name:"Credit Card",id:1},{name:"Cheque",id:2},{name:"EFT",id:3},{name:"Cash",id:4},{name:"Other",id:99}],itype_paymenttype_cc=1,itype_paymenttype_cheque=2,itype_paymenttype_eft=3,itype_paymenttype_cash=4,itype_paymenttype_other=99,paymentreasons=[{name:"Deposit",id:1},{name:"Order",id:2},{name:"POS",id:3},{name:"Other",id:99}],journaltypes=[{name:"Sales",id:1},{name:"Purchases",id:2},{name:"Payroll",id:3},{name:"Cash Receipts",id:4},{name:"Cash Disbursements",id:5},{name:"General",id:6},{name:"Inventory Purchase",id:7},{name:"Inventory Sale",id:8},{name:"Adjustment",id:99}],barcodetypes=[{id:"codabar"},{id:"code11"},{id:"code29"},{id:"code93"},{id:"code128"},{id:"ean8"},{id:"ean13"},{id:"std25"},{id:"int25"},{id:"msi"},{id:"datamatrix"}],orderstatustypes=[{name:"",id:0},{name:"Quote",id:1},{name:"Order",id:2},{name:"Invoiced",id:3},{name:"P.O. Received",id:4},{name:"Deposit Paid",id:5},{name:"Invoice Paid",id:6},{name:"Approved",id:100},{name:"Pending",id:101},{name:"On Hold",id:102},{name:"Completed",id:103},{name:"Back Order",id:104},{name:"Order Processed",id:105},{name:"Manufacturing",id:200},{name:"Picking",id:201},{name:"Ready for Despatch",id:202},{name:"Shipped",id:203},{name:"Artwork Approved",id:300},{name:"Plates Ordered",id:301},{name:"Plates Received",id:302},{name:"Printing",id:303},{name:"Printing Completed",id:304},{name:"Cuttting",id:305},{name:"Cuttting Completed",id:306},{name:"Forming",id:307},{name:"Product Built",id:308},{name:"Comment",id:99999}],titles=[{name:"Mr"},{name:"Mrs"},{name:"Ms"},{name:"Miss"},{name:"Dr"},{name:"Sir"},{name:""}],int_to_5=[{name:"1",id:1},{name:"2",id:2},{name:"3",id:3},{name:"4",id:4},{name:"5",id:5}],int_to_10=[{name:"1",id:1},{name:"2",id:2},{name:"3",id:3},{name:"4",id:4},{name:"5",id:5},{name:"6",id:6},{name:"7",id:7},{name:"8",id:8},{name:"9",id:9},{name:"10",id:10},{name:"11",id:11},{name:"12",id:12},{name:"13",id:13},{name:"14",id:14},{name:"15",id:15},{name:"16",id:16},{name:"17",id:17},{name:"18",id:18},{name:"19",id:19},{name:"20",id:20}],pricelevels=[{name:"Level 1",id:1},{name:"Level 2",id:2},{name:"Level 3",id:3},{name:"Level 4",id:4},{name:"Level 5",id:5},{name:"Level 6",id:6},{name:"Level 7",id:7},{name:"Level 8",id:8},{name:"Level 9",id:9},{name:"Level 10",id:10},{name:"Level 11",id:11},{name:"Level 12",id:12}],colour_white="#ffffff",colour_black="#000000",colour_steelblue="#4682b4",colour_maroon="#b03060",colour_forestgreen="#228b22",colour_dodgerblue="#1e90ff",colour_orangered="#ff4500",colour_bisque3="#cdb79e",colour_honeydew2="#e0eee0",colour_mistyrose="#ffe4e1",colour_lavender="#e6e6fa",colour_lemonchiffon="#fffacd",colour_slategrey="#708090",colour_snow4="#8b8989",colour_peachpuff3="#cdaf95",colour_cornflowerblue="#6495ed",colour_royalblue="#4169e1",colour_skyblue="#87ceeb",colour_darkturquoise="#00ced1",colour_mediumaqumarine="#66cdaa",colour_lawngreen="#7cfc00",colour_darkkhaki="#bdb76b",colour_seagreen="#2e8b57",colour_gold="#ffd700",colour_yellow="#ffff00",colour_goldenrod="#eee8aa",colour_rosybrown="#bc8f8f",colour_indianred="#cd5c5c",colour_sienna="#a0522d",colour_chocolate="#d2691e",colour_deeppink="#ff1493",colour_blueviolet="#8a2be2",colour_purple="#a020f0",colour_mediumorchid="#ba55d3",colour_darkorange="#ff8c00",colour_cadetblue=(colour_darkturquoise="#00ced1","#5f9ea0"),colour_olivedrab="#6b8e23",colour_ghostwhite="#f8f8ff",cache_accounts=[],cache_employees=[],cache_taxcodes=[],cache_superfunds=[],cache_clients=[],cache_suppliers=[],cache_locations=[],cache_productcategories=[],cache_porders=[],cache_producttemplates=[],cashe_permissiontemplates=[],cache_products=[],cache_users=[],cache_statusalerts=[],cache_exchangerates=[],cache_timesheets=[],cache_productsbycategory=[],cache_suppliernotes=[],cache_permissionTemplateNames=[],cache_permissiontemplates=[],cache_userpermissions=[],cache_orderproducts=[],cache_printtemplates=[],cache_buildtemplates=[],cache_config={},itype_js_printer=1,itype_js_printer_complete=2,itype_js_cutter=3,itype_js_cutter_complete=4,itype_js_build=5,itype_js_build_complete=6,js_types=[{name:"Print",id:1},{name:"Print Complete",id:2},{name:"Cutting",id:3},{name:"Cutting Complete",id:4},{name:"Build",id:5},{name:"Build Complete",id:6}],numberboxParseObj={parser:function(e){return mexp.eval(e)},formatter:function(e){return _.niceformatnumber(e,4,!1)},filter:function(e){return-1!="01234567890.*-+/() ".indexOf(e.key)||("Backspace"==e.key||"Delete"==e.key||"ArrowRight"==e.key||"ArrowLeft"==e.key||"Tab"==e.key||"Enter"==e.key)}},classtypes=[{name:"Claass A",id:1},{name:"Claass B",id:2},{name:"Claass C",id:3},{name:"Claass D",id:4}];function mapMimeTypeToImage(e){return _.isUndefined(e)||_.isBlank(e)||_.isNull(e)?"":'<img width="20" height="20" src="images/mimetypes/'+(_.hasstring(e,"image")?"mime-image.png":_.hasstring(e,"pdf")?"mime-pdf.png":_.hasstring(e,"excel")||_.hasstring(e,"spreadsheet")?"mime-spreadsheet.png":_.hasstring(e,"compress")?"mime-zip.png":_.hasstring(e,"document")?"mime-doc.png":_.hasstring(e,"powerpoint")?"mime-ppt.png":_.hasstring(e,"postscript")?"mime-vector.png":_.hasstring(e,"video")?"mime-video.png":_.hasstring(e,"audio")?"mime-audio.png":_.hasstring(e,"officedocument")||_.hasstring(e,"msword")?"mime-doc.png":"mime-attachment.png")+'" />'}function mapBatteryToImage(e,t){return'<img id="imgBatteryLevel" width="71" height="30" src="images/battery/'+(_.isUndefined(t)||_.isNull(t)||"charging"!=t.toLowerCase()?.8<e?"battery100.png":.6<e?"battery80.png":.4<e?"battery60.png":.2<e?"battery40.png":"battery20.png":"battery0.png")+'" />'}function mapBoolToImage(e){return'<img width="20" height="20" src="images/'+(_.isUndefined(e)||_.isNull(e)||!1===e||0===e||"0"===e?"blank.png":"tick.png")+'" />'}function mapAvatarToImage(e){return _.isUndefined(e)||_.isNull(e)||_.isBlank(e)?"":'<img width="30" height="30" src="images/avatars/'+e+'" />'}function mapUserStatusToImage(e){var t="ball-grey.png";return"online"==e?t="ball-green.png":"offline"==e?t="ball-black.png":"paused"==e?t="ball-darkblue.png":"polled"==e&&(t="ball-lightblue.png"),'<img width="30" height="30" src="images/led/'+t+'" />'}function mapUuidToImage(e){return""}function mapAccountTypeToImage(e){return"simonline"==status?"simonline.png":"simoffline"==status?"simoffline.png":"simactivated"==status?"simactivated.png":"simdeactivated"==status?"simdeactivated.png":"simnoconnection"==status?"simnoconnection.png":"simnotready.png"}function mapPaymentTypeToName(e){return 1==e?"Credit Card":2==e?"Cheque":3==e?"EFT":4==e?"Cash":"Other"}function showBusy(){$("body").css("cursor","progress"),$("#divDashConnectionStatus").html('<img style="vertical-align: middle;" src="images/ajax_processing.gif" width="220" height="20"/>')}function showIdle(){$("body").css("cursor","default"),connected?$("#divDashConnectionStatus").html('<img style="vertical-align: middle;" src="images/ajax_connected.gif" width="23" height="24"/>'):$("#divDashConnectionStatus").html('<img style="vertical-align: middle;" src="data:image/png;base64,'+b64disconnected+'" width="24" height="24"/> Waiting for server...')}function identity(e){return e}function doScrollToTopOfPage(){$("html, body").animate({scrollTop:0},"fast")}function doDisableInput(e){$("#"+e).attr("disabled","disabled")}function doEnableInput(e){$("#"+e).removeAttr("disabled")}function doNiceDate(e){return _.isUndefined(e)||_.isNull(e)?"":moment(e).format("YYYY-MM-DD HH:mm:ss")}function doNiceDateNoTime(e){return _.isUndefined(e)||_.isNull(e)?"":moment(e).format("YYYY-MM-DD")}function doNiceDateModifiedOrCreated(e,t){return _.isUndefined(e)||_.isNull(e)?moment(t).format("YYYY-MM-DD HH:mm:ss"):moment(e).format("YYYY-MM-DD HH:mm:ss")}function doNiceModifiedBy(e,t,n){return _.isUndefined(e)||_.isNull(e)?_.titleize(n):_.titleize(t)}function doNiceTitleizeString(e){return _.isUndefined(e)||_.isNull(e)?"":_.titleize(e)}function doNiceString(e){return _.isUndefined(e)||_.isNull(e)||0==e.length?"":e}function doNiceId(e){return _.isUndefined(e)||_.isNull(e)?null:e}function doNiceIntToBool(e){return!_.isUndefined(e)&&!_.isNull(e)&&0!=e}function doNiceUppercaseString(e){return _.isUndefined(e)||_.isNull(e)||0==e.length?"":e.toUpperCase()}function doNiceComments(e){return _.isUndefined(e)||_.isNull(e)||0==e.length?"":_.escape(e)}function doCustomAttributeLabelName(e,t){var n="#spnProductNewAttrib"+e;_.isBlank(t)?($(n).text("Attribute "+e+":"),$(n).css("font-weight","normal"),$(n).css("color",colour_black)):($(n).text(t+":"),$(n).css("font-weight","bold"),$(n).css("color",colour_chocolate))}function doSelectSalesTab(e,t){$("#as1tabs").tabs("select","Sales"),$("#salestabs").tabs("select",e),$("#divEvents").trigger("selectorderid",{id:t})}function doSelectJobSheetsTab(){$("#as1tabs").tabs("select","Job Sheets")}function doSelectPurchasingTab(e){$("#as1tabs").tabs("select","Purchasing"),$("#purchasingtabs").tabs("select",e)}function doSelectInventoryTab(e){$("#as1tabs").tabs("select","Inventory"),$("#inventorytabs").tabs("select",e)}function doSelectBankingTab(e){$("#as1tabs").tabs("select","Banking"),$("#bankingtabs").tabs("select",e)}function doSelectPayrollTab(e){$("#as1tabs").tabs("select","Payroll"),$("#payrolltabs").tabs("select",e)}function doSelectAccountsTab(e){$("#as1tabs").tabs("select","Accounts"),$("#accounttabs").tabs("select",e)}function doSelectDashTab(e){$("#as1tabs").tabs("select","Dashboard"),$("#dashtabs").tabs("select",e)}function doArrayToObject(e){for(var t={},n=0;n<e.length;n++)t[n]=e[n];return t}function doUpdateCacheName(e,t,n,i,d){e.forEach(function(e){e.id==t&&(e.name=n,_.isUndefined(i)||(e.date=i),_.isUndefined(d)||(e.by=d))})}function doGetUserNameFromUUID(t){var e=$.grep(cache_users,function(e){return e.uuid==t});return _.isNull(e)||0==e.length?"":e[0].name}function doGetObjFromIdInObjArray(e,t){var n=$.grep(e,function(e){return e.id==t});return _.isNull(n)||0==n.length?{}:n[0]}function doGetCodeFromIdInObjArray(e,t){var n=$.grep(e,function(e){return e.id==t});return _.isNull(n)||0==n.length?"":n[0].code}function doGetStringFromIdInObjArray(e,t){if(_.isUN(t))return"";var n=$.grep(e,function(e){return e.id==t});return _.isNull(n)||0==n.length?"":n[0].name}function doGetDescFromIdInObjArray(e,t){var n=$.grep(e,function(e){return e.id==t});return _.isNull(n)||0==n.length?"":n[0].description}function doGetIdFromStringInObjArray(e,t){var n=$.grep(e,function(e){return e.name==t});return _.isNull(n)||0==n.length?"":n[0].id}function doGetNameFromImage(t){var e=$.grep(avatars,function(e){return e.image==t});return _.isNull(e)||0==e.length?"":e[0].name}function doGetPercentFromTaxcode(t){var e=$.grep(cache_taxcodes,function(e){return e.id==t});return _.isNull(e)||0==e.length?0:e[0].percent}function doThrowOrderAttachment(e){var t=$("#ancSpare").get(0);t.target="_blank",t.href="/throworderattachment?orderattachmentid="+e+"&uuid="+uuid,t.click()}function doThrowClientAttachment(e){var t=$("#ancSpare").get(0);t.target="_blank",t.href="/throwclientattachment?clientattachmentid="+e+"&uuid="+uuid,t.click()}function doThrowProductImage(e){var t=$("#ancSpare").get(0);t.target="_blank",t.href="/throwproductimage?productimageid="+e+"&uuid="+uuid,t.click()}function doThrowPrintTemplate(e){var t=$("#ancSpare").get(0);t.target="_blank",t.href="/throwprinttemplate?printtemplateid="+e+"&uuid="+uuid,t.click()}function doLogin(){var e=$("#fldUid").textbox("getValue"),t=$("#fldPwd").passwordbox("getValue");primus.emit("login",{fguid:fguid,uid:e,pwd:t}),$("#divDashConnectionStatus").html('<img style="vertical-align: middle;" src="data:image/png;base64,'+b64gears+'" width="24" height="24"/> Authenticating... ')}function doPromptOkCancel(e,t){noty({text:e,type:"warning",animation:{open:"animated flipInX",close:"animated flipOutX",easing:"swing",speed:500},buttons:[{addClass:"btn btn-primary",text:"Ok",onClick:function(e){e.close(),_.isUndefined(t)||_.isNull(t)||t(!0)}},{addClass:"btn btn-danger",text:"Cancel",onClick:function(e){e.close(),_.isUndefined(t)||_.isNull(t)||t(null)}}]})}function doPromptYesNoCancel(e,t){noty({text:e,type:"warning",animation:{open:"animated flipInX",close:"animated flipOutX",easing:"swing",speed:500},buttons:[{addClass:"btn btn-primary",text:"Yes",onClick:function(e){e.close(),_.isUndefined(t)||_.isNull(t)||t(!0)}},{addClass:"btn btn-primary",text:"No",onClick:function(e){e.close(),_.isUndefined(t)||_.isNull(t)||t(!1)}},{addClass:"btn btn-danger",text:"Cancel",onClick:function(e){e.close(),_.isUndefined(t)||_.isNull(t)||t(null)}}]})}function doPrompt2OptionsCancel(e,t,n,i){noty({text:e,type:"warning",animation:{open:"animated flipInX",close:"animated flipOutX",easing:"swing",speed:500},buttons:[{addClass:"btn btn-primary",text:t,onClick:function(e){e.close(),_.isUndefined(i)||_.isNull(i)||i(1)}},{addClass:"btn btn-primary",text:n,onClick:function(e){e.close(),_.isUndefined(i)||_.isNull(i)||i(2)}},{addClass:"btn btn-danger",text:"Cancel",onClick:function(e){e.close(),_.isUndefined(i)||_.isNull(i)||i(null)}}]})}function doPrompt3OptionsCancel(e,t,n,i,d){noty({text:e,type:"warning",animation:{open:"animated flipInX",close:"animated flipOutX",easing:"swing",speed:500},buttons:[{addClass:"btn btn-primary",text:t,onClick:function(e){e.close(),_.isUndefined(d)||_.isNull(d)||d(1)}},{addClass:"btn btn-primary",text:n,onClick:function(e){e.close(),_.isUndefined(d)||_.isNull(d)||d(2)}},{addClass:"btn btn-primary",text:i,onClick:function(e){e.close(),_.isUndefined(d)||_.isNull(d)||d(3)}},{addClass:"btn btn-danger",text:"Cancel",onClick:function(e){e.close(),_.isUndefined(d)||_.isNull(d)||d(null)}}]})}function doUpdateInitTasksProgress(){if(0<inittasks){var e=++completedtasks/inittasks*100;$("#divProgress").progressbar("setValue",Math.ceil(e)),100<=e&&($("#divProgress").hide(),$("#divDashConnectionStatus").html('<img style="vertical-align: middle;" src="images/ajax_connected.gif" width="23" height="24"/>'))}}function doRefreshAll(){inittasks=14,completedtasks=0,$("#divProgress").progressbar({value:0}),doServerDataMessage("listclients",{showinactive:!1},{type:"refresh"}),doServerMessage("listsuppliers",{type:"refresh"}),doServerMessage("listlocations",{type:"refresh"}),doServerMessage("listaccounts",{type:"refresh"}),doServerMessage("listtaxcodes",{type:"refresh"}),doServerMessage("listsuperfunds",{type:"refresh"}),doServerMessage("listpayrollemployees",{type:"refresh"}),doServerMessage("listemployees",{type:"refresh"}),doServerMessage("listusers",{type:"refresh"}),doServerMessage("listpermissiontemplates",{type:"refresh"}),doServerMessage("listproductcategories",{type:"refresh"}),doServerMessage("listproducttemplates",{type:"refresh"}),doServerMessage("listproducts",{type:"refresh"}),doServerMessage("listexchangerates",{type:"refresh"}),doServerMessage("listprinttemplates",{type:"refresh"}),doServerMessage("loadconfig",{type:"refresh"}),primus.emit("latestrates",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}function doGetCountTreeArray(e){return function e(t){for(var n=t.length,i=0,d=t.length;i<d;i++){var o=t[i];!_.isUndefined(o.children)&&0<o.children.length&&(n+=e(o.children))}return n}(e)}function doGetNameFromTreeArray(e,t){return node=function e(t,n){for(var i=null,d=0,o=t.length;d<o&&_.isNull(i);d++){var a=t[d];a.id==n?i=a:!_.isUndefined(a.children)&&0<a.children.length&&(i=e(a.children,n))}return i}(e,t),_.isNull(node)?"":node.name}function doGetTextFromTreeArray(e,t){return node=function e(t,n){for(var i=null,d=0,o=t.length;d<o&&_.isNull(i);d++){var a=t[d];a.id==n?i=a:!_.isUndefined(a.children)&&0<a.children.length&&(i=e(a.children,n))}return i}(e,t),_.isNull(node)?"":node.text}function doSearchCodeNameInTree(e,t){var n,i="#"+e,d=$(i).treegrid("getData"),o=$(i).treegrid("getSelected"),l=_.isNull(o)?null:o.id;return n=function e(t,n){for(var i=null,d=0,o=t.length;d<o&&_.isNull(i);d++){var a=t[d];if(_.isNull(l)){var r=a.code.toUpperCase(),s=a.name.toUpperCase();-1<r.indexOf(n)||-1<s.indexOf(n)?i=a.id:!_.isUndefined(a.children)&&0<a.children.length&&(i=e(a.children,n))}else a.id==l&&(l=null),!_.isUndefined(a.children)&&0<a.children.length&&(i=e(a.children,n))}return i}(d,t.toUpperCase()),_.isNull(n)?noty({text:"No more occurrences found...",type:"warning",timeout:4e3}):($(i).treegrid("expandTo",n),$(i).treegrid("select",n)),n}function doExpandTreeToId(e,t,n){if(_.isUndefined(t)||_.isNull(t))$(i).treegrid("unselectAll");else{var i="#"+e;_.isNull($(i).treegrid("find",t))||($(i).treegrid("expandTo",t),$(i).treegrid("select",t),_.isUndefined(n)||!0!==n||$(i).treegrid("expand",t))}}function doTreeReloadAndExpandToId(e,t){var n="#"+e;$(n).treegrid("reload"),_.isUndefined(t)||_.isNull(t)?$(n).treegrid("unselectAll"):_.isNull($(n).treegrid("find",t))||($(n).treegrid("expandTo",t),$(n).treegrid("select",t))}function doFindParentNode(e,t){return function e(t,n){for(var i=null,d=0,o=t.length;d<o&&_.isNull(i);d++){var a=t[d];a.id==n?i=a:!_.isUndefined(a.children)&&0<a.children.length&&(i=e(a.children,n))}return i}(e,t)}function doSearchCodeNameInGrid(e,t,n,i){var d="#"+e,o=$(d).datagrid("getRows"),a=$(d).datagrid("getSelected"),r=_.isNull(a)?null:_.isNull(i)||_.isUndefined(i)?a.id:a[i],s=t.toUpperCase(),l=null,c=0;_.isNull(r)||(c=$(d).datagrid("getRowIndex",r)+1),(_.isUndefined(n)||_.isNull(n))&&(n="code");for(var u=c,m=o.length;u<m;u++){var f=o[u];if(!_.isNull(f)&&!_.isUndefined(f)){var p=f[n];if(!_.isNull(p)&&!_.isUndefined(p)&&(-1<(p=p.toUpperCase()).indexOf(s)||-1<name.indexOf(s))){l=u;break}}}_.isNull(l)?doShowWarning("No more occurrences found..."):$(d).datagrid("selectRow",l)}function doSetGridEditorValue(e,t,n,i){var d=$("#"+e).datagrid("getEditor",{index:t,field:n});_.isUndefined(d)||_.isNull(d)||$(d.target).val(i)}function doSetGridEditorComboValue(e,t,n,i){var d=$("#"+e).datagrid("getEditor",{index:t,field:n});_.isUndefined(d)||_.isNull(d)||$(d.target).combobox("select",i)}function doGetGridGetRowDataByIndex(e,t,n){var i,d="#"+e;$(d).datagrid("selectRow",t),i=$(d).datagrid("getSelected"),_.isNull(i)||_.isUndefined(n)||_.isNull(n)||n(i,t)}function doGetGridSelectedRowIndex(e){var t="#"+e,n=$(t).datagrid("getSelected");return _.isNull(n)||(index=$(t).datagrid("getRowIndex",n)),index}function doGetGridFindId(e,t,n){var i=$("#"+e).datagrid("getRowIndex",t);_.isUndefined(n)||_.isNull(n)||(-1==i?n({index:i},null):n(null,i))}function doUpdateGridSelectedRow(e,t){var n="#"+e,i=null,d=$(n).datagrid("getSelected");return _.isNull(d)||(i=$(n).datagrid("getRowIndex",d),$(n).datagrid("updateRow",{index:i,row:t}),$(n).datagrid("unselectRow",i)),{row:d,index:i}}function doUpdateGridRow(e,t,n){var i,d="#"+e;return i=$(d).datagrid("getRowIndex",t),$(d).datagrid("updateRow",{index:i,row:n}),$(d).datagrid("unselectRow",i),{row:n,index:i}}function doGridRemoveRow(e,t){var n="#"+e,i=$(n).datagrid("getRowIndex",t);_.isNull(i)||$(n).datagrid("deleteRow",i)}function doGridGetSelectedRowData(e,t){var n="#"+e,i=$(n).datagrid("getSelected");if(_.isNull(i))return!1;_.isUndefined(t)||_.isNull(t)||t(i,$(n).datagrid("getRowIndex",i.id));return!0}function doGridStartEdit(e,t,n){var i="#"+e;if(_.isNull(t)){var d=$(i).datagrid("getSelected");_.isNull(d)||(t=$(i).datagrid("getRowIndex",d),$(i).datagrid("beginEdit",t),_.isUndefined(n)||_.isNull(n)||n(d,t))}return t}function doGridGetEditor(e,t,n,i){var d=$("#"+e).datagrid("getEditor",{index:t,field:n});_.isNull(d)||($(d.target).focus(),_.isUndefined(i)||_.isNull(i)||i(d))}function doGridCancelEdit(e,t,n){var i="#"+e;return _.isNull(t)||($(i).datagrid("cancelEdit",t),_.isUndefined(n)||_.isNull(n)||n()),null}function doGridEndEditGetRow(e,t,n){if(_.isNull(t))return!1;var i="#"+e;$(i).datagrid("endEdit",t),$(i).datagrid("selectRow",t);var d=$(i).datagrid("getSelected");return _.isNull(d)||_.isUndefined(n)||_.isNull(n)||n(d),!0}function doComboGridGetSelectedRowData(e,t){var n=$("#"+e).combogrid("grid"),i=n.datagrid("getSelected");if(_.isNull(i))return!1;_.isUndefined(t)||_.isNull(t)||t(i,$(n).datagrid("getRowIndex",i.id));return!0}function doGridCalcProductTotals(e,t,n,i){var d="#"+e,o=$(d).datagrid("getData"),a=_.toBigNum(0),r=_.toBigNum(0),s=null,l=null,c=null,u=null;_.isNull(o)||_.isNull(o.rows)||o.rows.forEach(function(e){u=doGetObjFromIdInObjArray(cache_products,e[t]),s=_.toBigNum(e[i]),l=_.toBigNum(e[n]),a=_.isEmpty(u)?a.plus(l.times(s)):_.isBlank(u.uomsize)?a.plus(l.times(s)):(c=_.toBigNum(u.uomsize),a.plus(l.times(s.dividedBy(c)))),r=r.plus(s)});var m={};return m[n]='<span class="totals_footer">'+_.niceformatnumber(a)+"</span>",m[i]='<span class="totals_footer">'+_.niceformatnumber(r)+"</span>",$(d).datagrid("reloadFooter",[m]),{price:a,qty:r,formattedprice:m[n],formattedqty:m[i]}}function doGridCalcTotals(e,t,n,i,d){var o="#"+e,a=$(o).datagrid("getData"),r=_.toBigNum(0),s=_.toBigNum(0),l=null,c=null,u=null,m=null,f=null,p=!_.isUndefined(n),g=!_.isUndefined(i),h=!_.isUndefined(d);_.isNull(a)||_.isNull(a.rows)||a.rows.forEach(function(e){p?(l=_.toBigNum(accounting.unformat(e[n])),s=s.plus(l)):l=1,c=g?_.toBigNum(accounting.unformat(e[i])):0,u=h?_.toBigNum(accounting.unformat(e[d])):0,m=_.toBigNum(accounting.unformat(e[t])),f=m.times(l),r=(r=(r=r.plus(f)).minus(f.times(c).div(100))).plus(f.times(u).div(100))});var b={};return b[t]='<span class="totals_footer">'+_.niceformatnumber(r)+"</span>",p&&(b[n]='<span class="totals_footer">'+_.niceformatnumber(s)+"</span>"),$(o).datagrid("reloadFooter",[b]),{price:r,qty:s,formattedprice:b[t],formattedqty:p?b[n]:""}}function doGridChangeCellLabelValue(e,t,n,i){var d=$("#"+e).datagrid("getEditor",{index:t,field:n});_.isNull(d)||$(d.target).html(i)}function doGridContextMenu(e,t,n,i,d){if(!_.isNull(d)){var o="#"+e;n.preventDefault(),$(o).datagrid("selectRow",i),$("#"+t).menu("show",{left:n.pageX,top:n.pageY})}}function doGridSelectRowById(e,t){var n="#"+e;_.isUndefined(t)||_.isNull(t)?$(n).datagrid("clearSelections"):$(n).datagrid("selectRecord",t)}function doGridReloadAndSelectId(e,t){var n="#"+e;$(n).datagrid("reload"),_.isUndefined(t)||_.isNull(t)?$(n).datagrid("clearSelections"):$(n).datagrid("selectRecord",t)}function doTreeGridGetRowData(e,t,n){var i="#"+e;if(!_.isNull(t)){var d=$(i).treegrid("find",t);_.isNull(d)||_.isUndefined(n)||_.isNull(n)||n(d)}return t}function doTreeGridGetSelectedRowData(e,t){var n=$("#"+e).treegrid("getSelected");return!_.isNull(n)&&(_.isUndefined(t)||_.isNull(t)||t(n),!0)}function doTreeGridStartEdit(e,t,n){var i="#"+e;if(_.isNull(t)){var d=$(i).treegrid("getSelected");_.isNull(d)||(t=d.id,$(i).treegrid("beginEdit",t),_.isUndefined(n)||_.isNull(n)||n(d,t))}return t}function doTreeGridGetSelectedRowEditor(e,t,n){var i="#"+e,d=$(i).treegrid("getSelected");if(!_.isNull(d)){var o=$(i).treegrid("getEditor",{id:d.id,field:t});_.isNull(o)||($(o.target).focus(),_.isUndefined(n)||_.isNull(n)||n(o))}}function doTreeGridGetEditor(e,t,n,i){var d=$("#"+e).treegrid("getEditor",{id:t,field:n});_.isNull(d)||($(d.target).focus(),_.isUndefined(i)||_.isNull(i)||i(d))}function doTreeGridEndEditGetRow(e,t,n){if(_.isNull(t))return!1;var i="#"+e;$(i).treegrid("endEdit",t),$(i).treegrid("select",t);var d=$(i).treegrid("getSelected");return _.isNull(d)||_.isUndefined(n)||_.isNull(n)||n(d),!0}function doTreeGridCancelEdit(e,t,n){var i="#"+e;return _.isNull(t)||($(i).treegrid("cancelEdit",t),_.isUndefined(n)||_.isNull(n)||n()),null}function doTreeGridContextMenu(e,t,n,i){if(!_.isNull(i)){var d="#"+e;n.preventDefault(),$(d).treegrid("select",i.id),$("#"+t).menu("show",{left:n.pageX,top:n.pageY})}}function doShowGridLoading(e){$("#"+e).datagrid("loading")}function doShowGridLoaded(e){$("#"+e).datagrid("loaded")}function doGetComboTreeSelectedId(e){var t=$("#"+e).combotree("tree");if(!_.isNull(t)){var n=t.tree("getSelected");if(!_.isNull(n))return n.id}return null}function doComboTreeSelectId(e,t){var n=$("#"+e).combotree("tree");if(_.isNull(n))return null;var i=$(n).tree("find",t);return _.isNull(i)||($(n).tree("expandTo",i.target),$(n).tree("select",i.target)),t}function doLinkButtonSelected(e){return $("#"+e).linkbutton("options").selected}function doRadioButtonChecked(e){return $("#"+e).radiobutton("options").checked}function doSwitchButtonChecked(e){return $("#"+e).switchbutton("options").checked}function doSetSwitchButton(e,t){var n=!_.isUndefined(t)&&(!0===t||1==t||"1"==t)?"check":"uncheck";$("#"+e).switchbutton(n)}function doRemoveTBButton(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n].text==t){e.splice(n,1);break}}function doTextboxFocus(e){$("#"+e).textbox("textbox").focus()}function doMandatoryTextbox(e,t){noty({text:e,type:"error",timeout:4e3}),doTextboxFocus(t)}function doAddressAutofill(e,t,n,i,d){if(!_.isUndefined(e)&&!_.isUndefined(e.address_components)){var o="#"+t,a="#"+n,r="#"+i,s="#"+d;8==e.address_components.length?($(o).textbox("setValue",e.name),$(a).textbox("setValue",e.address_components[3].short_name),$(r).textbox("setValue",e.address_components[7].short_name),$(s).combobox("setValue",e.address_components[5].short_name)):($(o).textbox("setValue",e.name),$(a).textbox("setValue",e.address_components[2].short_name),$(r).textbox("setValue",e.address_components[6].short_name),$(s).combobox("setValue",e.address_components[4].short_name))}}function initMap(){if(ispos){var e=new google.maps.places.Autocomplete($("#fldNewCustAddress1").textbox("textbox")[0],{types:["geocode"],componentRestrictions:{country:defaultRegionCode}});google.maps.event.addListener(e,"place_changed",function(){doAddressAutofill(e.getPlace(),"fldNewCustAddress1","fldNewCustCity","fldNewCustPostcode","cbNewCustState")})}else{e=new google.maps.places.Autocomplete($("#fldNewClientAddress1").textbox("textbox")[0],{types:["geocode"],componentRestrictions:{country:defaultRegionCode}});var t=new google.maps.places.Autocomplete($("#fldNewClientShippingAddress1").textbox("textbox")[0],{types:["geocode"],componentRestrictions:{country:defaultRegionCode}}),n=new google.maps.places.Autocomplete($("#fldNewSupplierAddress1").textbox("textbox")[0],{types:["geocode"],componentRestrictions:{country:defaultRegionCode}}),i=new google.maps.places.Autocomplete($("#fldNewSupplierShippingAddress1").textbox("textbox")[0],{types:["geocode"],componentRestrictions:{country:defaultRegionCode}}),d=new google.maps.places.Autocomplete($("#fldNewLocationAddress1").textbox("textbox")[0],{types:["geocode"],componentRestrictions:{country:defaultRegionCode}}),o=new google.maps.places.Autocomplete($("#fldNewEmployeeAddress1").textbox("textbox")[0],{types:["geocode"],componentRestrictions:{country:defaultRegionCode}}),a=new google.maps.places.Autocomplete($("#fldNewOrderAddress1").textbox("textbox")[0],{types:["geocode"],componentRestrictions:{country:defaultRegionCode}}),r=new google.maps.places.Autocomplete($("#fldNewOrderShiptoAddress1").textbox("textbox")[0],{types:["geocode"],componentRestrictions:{country:defaultRegionCode}});google.maps.event.addListener(e,"place_changed",function(){doAddressAutofill(e.getPlace(),"fldNewClientAddress1","fldNewClientCity","fldNewClientPostcode","cbNewClientState")}),google.maps.event.addListener(t,"place_changed",function(){doAddressAutofill(t.getPlace(),"fldNewClientShippingAddress1","fldNewClientShippingCity","fldNewClientShippingPostcode","cbNewClientShippingState")}),google.maps.event.addListener(n,"place_changed",function(){doAddressAutofill(n.getPlace(),"fldNewSupplierAddress1","fldNewSupplierCity","fldNewSupplierPostcode","cbNewSupplierState")}),google.maps.event.addListener(i,"place_changed",function(){doAddressAutofill(i.getPlace(),"fldNewSupplierShippingAddress1","fldNewSupplierShippingCity","fldNewSupplierShippingPostcode","cbNewSupplierShippingState")}),google.maps.event.addListener(d,"place_changed",function(){doAddressAutofill(d.getPlace(),"fldNewLocationAddress1","fldNewLocationCity","fldNewLocationPostcode","cbNewLocationState")}),google.maps.event.addListener(o,"place_changed",function(){doAddressAutofill(o.getPlace(),"fldNewEmployeeAddress1","fldNewEmployeeCity","fldNewEmployeePostcode","cbNewEmployeeState")}),google.maps.event.addListener(a,"place_changed",function(){doAddressAutofill(a.getPlace(),"fldNewOrderAddress1","fldNewOrderCity","fldNewOrderPostcode","cbNewOrderState")}),google.maps.event.addListener(r,"place_changed",function(){doAddressAutofill(r.getPlace(),"fldNewOrderShiptoAddress1","fldNewOrderShiptoCity","fldNewOrderShiptoPostcode","cbNewOrderShiptoState")})}}function doShowMap(e,t,n,i){var d=null;$("#divMapPanel").window({title:n,href:"template_showmap2.html",onLoad:function(){d=L.map("xx_map").setView([e,t],16),L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(d),L.marker([e,t]).addTo(d).bindPopup(i).openPopup()},onClose:function(){d.remove(),d=null}}).window("open")}function doContextMenu(e,t){$("#divEvents").trigger(e,t)}function doFeedback(){doDlgFeedback()}function doShowError(e){noty({text:e,type:"error",timeout:4e3})}function doShowWarning(e){noty({text:e,type:"warning",timeout:4e3})}function doShowSuccess(e){noty({text:e,type:"success",timeout:4e3})}function doShowInfo(e){noty({text:e,type:"information",animation:{open:"animated fadeIn",close:"animated fadeOut",easing:"swing",speed:500},layout:"topRight",timeout:3e3})}function doShowChat(e){noty({text:e,type:"information",animation:{open:"animated fadeIn",close:"animated hinge",easing:"swing",speed:500},layout:"topRight"})}function doShowResults(e){noty({text:e,type:"information",animation:{open:"animated fadeIn",close:"animated fadeOut",easing:"swing",speed:500},layout:"topRight"})}function doServerDataMessage(e,t,n){primus.emit(e,$.extend(t,{fguid:fguid,uuid:uuid,session:session,pdata:$.extend(n,{})}))}function doServerMessage(e,t){primus.emit(e,{fguid:fguid,uuid:uuid,session:session,pdata:$.extend(t,{})})}_.mixin(_.str.exports()),_.mixin({escapeSingleQuotes:function(e){return _.isUndefined(e)||_.isNull(e)?"":_.isNumber(e)?e:e.replace(/'/g,"\\'")}}),_.mixin({escapeDoubleQuotes:function(e){return _.isUndefined(e)||_.isNull(e)?"":_.isNumber(e)?e:e.replace(/"/g,'\\"')}}),_.mixin({repeat:function(e,t){if(t<1)return"";for(var n="",i=e.valueOf();0<t;)1&t&&(n+=i),t>>=1,i+=i;return n}}),_.mixin({countslashes:function(e){var t=e.match(/\//gim);return _.isUndefined(t)||_.isNull(t)?0:t.length}}),_.mixin({reverseArray:function(e){var t=null,n=null;for(t=0,n=e.length-1;t<n;t+=1,n-=1){var i=e[t];e[t]=e[n],e[n]=i}return e}}),_.mixin({stripnonnumeric:function(e){e+="";for(var t=/^\d|\.|-$/,n="",i=0;i<e.length;i++)t.test(e.charAt(i))&&("."==e.charAt(i)&&-1!=n.indexOf(".")||"-"==e.charAt(i)&&0!=n.length||(n+=e.charAt(i)));return n}}),_.mixin({makeaddress:function(e){var t=!_.isUndefined(e.nice)&&!_.isNull(e.nice)&&e.nice,n=_.isUndefined(e.address1)||_.isNull(e.address1)?"":_.titleize(e.address1),i=_.isUndefined(e.city)||_.isNull(e.city)?"":_.titleize(e.city),d=_.isUndefined(e.state)||_.isNull(e.state)?"":_.titleize(e.state),o=_.isUndefined(e.postcode)||_.isNull(e.postcode)?"":e.postcode,a=_.isUndefined(e.country)||_.isNull(e.country)?"":_.titleize(e.country),r=n;return""!=i&&(r=""==r?i:t?r+",<br/>"+i:r+", "+i),""!=d&&(r=""==r?d:t?r+",<br/>"+d:r+", "+d),""!=o&&(r=""==r?o:r+" "+o),""!=a&&(r=""==r?a:t?r+",<br/>"+a:r+", "+a),r}}),_.mixin({humaniseSeconds:function(e){var t="",n=Math.floor(e/31536e3),i=Math.floor(e%31536e3/86400),d=Math.floor(e%31536e3%86400/3600),o=Math.floor(e%31536e3%86400%3600/60),a=Math.floor(e%31536e3%86400%3600%60);return 0<n&&(t=n,t+=1==n?" Year, ":" Years, "),0<i&&(t+=i,t+=1==i?" Day, ":" Days, "),0<d&&(t+=d,t+=1==d?" Hour, ":" Hours, "),0<o&&(t+=o,t+=1==o?" Minute, ":" Minutes, "),t+=a,t+=1==a?" Second":" Seconds"}}),_.mixin({totype:function(e){return{}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()}}),_.mixin({sanitiseAsNumeric:function(e,t){if(_.isUndefined(e)||_.isNull(e)||isNaN(e)||_.isBlank(e)||0==e)return 0;var n=_.isUndefined(t)?4:t;return e instanceof Decimal?e.toFixed(n):new Decimal(e).toFixed(n)}}),_.mixin({formatnumber:function(e,t,n){if(_.isUndefined(e)||_.isNull(e)||isNaN(e)||_.isBlank(e)||0==e)return _.isUndefined(n)||1==n?"":0;var i=_.isUndefined(t)?2:t;return e instanceof Decimal?e.toFixed(i):new Decimal(e).toFixed(i)}}),_.mixin({niceformatnumber:function(e,t,n){if(_.isUndefined(e)||_.isNull(e)||isNaN(e)||_.isBlank(e)||0==e)return _.isUndefined(n)||1==n?"":0;var i=_.isUndefined(t)?2:t;return e instanceof Decimal?accounting.formatNumber(e.toFixed(i),i,","):accounting.formatNumber(e,i,",")}}),_.mixin({niceformatqty:function(e,t){if(_.isUndefined(e)||_.isNull(e)||isNaN(e)||_.isBlank(e)||0==e)return"";var n=_.isUndefined(t)?4:t;return e instanceof Decimal?accounting.formatNumber(e.toFixed(n),0,","):accounting.formatNumber(e,n,",")}}),_.mixin({formatinteger:function(e){return _.isUndefined(e)||_.isNull(e)||isNaN(e)||_.isBlank(e)||0==e?"":e instanceof Decimal?e.toFixed(0):new Decimal(e).toFixed(0)}}),_.mixin({toBigNum:function(e){return _.isUndefined(e)||_.isNull(e)||isNaN(e)||_.isBlank(e)||0==e?new Decimal(0):e instanceof Decimal?e:new Decimal(e)}}),_.mixin({hasstring:function(e,t){return!_.isUndefined(e)&&!_.isUndefined(t)&&-1<e.indexOf(t)}}),_.mixin({nicedatetodisplay:function(e){return _.isUndefined(e)||_.isNull(e)||_.isBlank(e)||"Invalid date"==e?"":new moment(e,"YYYY-MM-DD hh:mm:ss").format("YYYY-MM-DD")}}),_.mixin({nicejsdatetodisplay:function(e){return _.isUndefined(e)||_.isNull(e)||_.isBlank(e)||"Invalid date"==e?"":new moment(e,"MM/DD/YYYY").format("YYYY-MM-DD")}}),_.mixin({friendlydisplaydate:function(e){return _.isUndefined(e)||_.isNull(e)||_.isBlank(e)||"Invalid date"==e?"":new moment(e).format("dddd, MMMM Do YYYY")}}),_.mixin({posdisplaydate:function(e){return _.isUndefined(e)||_.isNull(e)||_.isBlank(e)||"Invalid date"==e?"":new moment(e).format("ddd, MMM Do h:mm a")}}),_.mixin({validateemail:function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}}),_.mixin({forcehtmlspacerpad:function(e,t){return e.length<t&&(e+=" "+_.repeat("&nbsp;",t-e.length)),e}}),_.mixin({forcehtmlspacelpad:function(e,t){return e.length<t&&(e=_.repeat("&nbsp;",t-e.length)+" "+e),e}}),_.mixin({isUNBZ:function(e){return _.isUndefined(e)||_.isNull(e)||_.isBlank(e)||0==e}}),_.mixin({isUNB:function(e){return _.isUndefined(e)||_.isNull(e)||_.isBlank(e)}}),_.mixin({isUN:function(e){return _.isUndefined(e)||_.isNull(e)}}),_.mixin({wordwrap:function(e,t){if(t=t||{},_.isNull(e))return e;var n=t.width||50,i="string"==typeof t.indent?t.indent:"",d=t.newline||"\n"+i,o="function"==typeof t.escape?t.escape:identity,a=".{1,"+n+"}";!0!==t.cut&&(a+="([\\s​]+|$)|[^\\s​]+?([\\s​]+|$)");var r=new RegExp(a,"g"),s=i+(e.match(r)||[]).map(function(e){return"\n"===e.slice(-1)&&(e=e.slice(0,e.length-1)),o(e)}).join(d);return!0===t.trim&&(s=s.replace(/[ \t]*$/gm,"")),s}});