var jobsheetsTabWidgetsLoaded=!1;function doJobSheetsTabWidgets(){function e(){doServerMessage("tpccorderbuilds",{type:"refresh"})}jobsheetsTabWidgetsLoaded||(jobsheetsTabWidgetsLoaded=!0,$("#divEvents").on("tpccorderbuilds",function(e,t){var o=[];t.data.rs.forEach(function(e){o.push({orderid:doNiceId(e.orderid),orderno:doNiceString(e.orderno),jobsheetid:doNiceId(e.jobsheetid),jobsheetno:doNiceString(e.jobsheetno),datestarted:doNiceDate(e.datestarted),datecompleted:doNiceDate(e.datecompleted),clientname:doNiceString(e.clientname),productid:doNiceId(e.productid),productcode:doNiceString(e.productcode),buildtemplateid:doNiceId(e.buildtemplateid),qtyordered:_.formatnumber(e.qtyordered,4),qtybuilt:_.formatnumber(e.qtybuilt,4),dateordered:doNiceDate(e.dateordered),userordered:doNiceTitleizeString(e.userordered),userbuilt:doNiceTitleizeString(e.userbuilt),imagename:doNiceString(e.imagename),imagemimetype:doNiceString(e.imagemimetype)})}),$("#divJobSheetsG").datagrid("loadData",o)}),$("#divEvents").on("neworderbuild",e),$("#divEvents").on("saveorrderbuild",e),$("#divEvents").on("expireorderbuild",e),$("#divEvents").on("listorders",e),$("#divEvents").on("buildinventory",e),$("#divEvents").on("inventorybuilt",e),$("#divEvents").on("tpccsavejobsheet",e),$("#divEvents").on("tpccjobsheetcreated",e),$("#divEvents").on("tpccjobsheetexpired",e),$("#divEvents").on("tpccjobsheetsaved",e),$("#divEvents").on("orderbuildspopup",function(e,t){"build"==t&&doBuild()}),$("#divEvents").on("selectjobsheetbyorderid",function(e,t){if(!_.isUndefined(t.orderid)&&!_.isNull(t.orderid))for(var o=$("#divJobSheetsG").datagrid("getData"),i=0;i<o.rows.length;i++)if(o.rows[i].orderid==t.orderid){$("#divJobSheetsG").datagrid("selectRecord",o.rows[i].jobsheetid);break}}),$("#divEvents").on("selectjobsheetbyorderno",function(e,t){if(!_.isUndefined(t.jobsheetno)&&!_.isNull(t.jobsheetno)){var o,i=$("#divJobSheetsG").datagrid("getData");0<(o=new Fuse(i.rows,{keys:["jobsheetno"],caseSensitive:!1,shouldSort:!0}).search(t.jobsheetno)).length&&doDlgJobSheet(o[0].jobsheetid)}}),$("#divEvents").on("jobsheetspopup",function(e,t){"order"==t?doGridGetSelectedRowData("divJobSheetsG",function(e){doSelectSalesTab("Orders",e.orderid)})||doShowError("Please select an order to view"):"clear"==t?$("#divJobSheetsG").datagrid("clearSelections"):"print"==t?doGridGetSelectedRowData("divJobSheetsG",function(e){doServerDataMessage("tpccprintjobsheet",{jobsheetid:e.jobsheetid},{type:"refresh"})})||doShowError("Please select a job to print"):"email"==t?doGridGetSelectedRowData("divJobSheetsG",function(e){})||doShowError("Please select a job to email"):"search"==t&&doDlgTPCCJobSearch()}),$("#divJobSheetsG").datagrid({idField:"jobsheetid",fitColumns:!1,singleSelect:!0,rownumbers:!0,striped:!0,toolbar:"#tbJobSheets",showFooter:!0,fit:!0,autoRowHeight:!1,onLoadSuccess:function(){$(this).datagrid("enableDnd")},frozenColumns:[[{title:"Order #",rowspan:2,field:"orderno",width:120,align:"left",resizable:!0},{title:"Name",rowspan:2,field:"clientname",width:300,align:"left",resizable:!0}],[]],columns:[[{title:"Job #",rowspan:2,field:"jobsheetno",width:120,align:"left",resizable:!0},{title:"Repeat?",rowspan:2,field:"isrepeat",width:80,align:"center",resizable:!0,formatter:function(e,t){return mapBoolToImage(e)}},{title:"Thumb",rowspan:2,field:"imagename",width:50,align:"center",resizable:!0,formatter:function(e,t){return o=e,_.isUndefined(o)||_.isBlank(o)||_.isNull(o)?"":'<img width="20" height="20" src="'+o+'" style="max-width: 100%; max-height: 20px;"/>';var o}},{title:"Product",rowspan:2,field:"productcode",width:200,align:"left",resizable:!0},{title:"Qty",colspan:2},{title:"Date",rowspan:2,field:"dateordered",width:150,align:"right",resizable:!0},{title:"By",rowspan:2,field:"userordered",width:200,align:"left",resizable:!0}],[{title:"Ordered",field:"qtyordered",width:100,align:"right",resizable:!0,formatter:function(e,t){return _.niceformatqty(e,0)}},{title:"Built",field:"qtybuilt",width:100,align:"right",resizable:!0,formatter:function(e,t){return _.niceformatqty(e,0)}}]],onDrop:function(e,t,o){var i=$("#divJobSheetsG").datagrid("getData"),d=[];i.rows.forEach(function(e){d.push({orderid:e.orderid,jobsheetid:e.jobsheetid})}),console.log(d),doServerDataMessage("tpccjobsheetsort",{jobs:d},{type:"refresh"})},onRowContextMenu:function(e,t,o){doGridContextMenu("divJobSheetsG","divJobSheetsMenuPopup",e,t,o)},onDblClickCell:function(e,t,o){doGetGridGetRowDataByIndex("divJobSheetsG",e,function(e){doDlgJobSheet(e.jobsheetid)})}}),doServerMessage("tpccorderbuilds",{type:"refresh"}))}