function doDlgProductCategoryNew(e,d){var r=_.isUndefined(d)||_.isNull(d),o={};function a(){$("#cbNewProductCategoryParent").combotree("setValue",e),r?($("#fldNewProductCategoryName").textbox("clear"),$("#fldNewProductCategoryCode").textbox("clear"),$("#btnProductCategoryNewAdd").linkbutton("disable")):_.isEmpty(o)||($("#fldNewProductCategoryName").textbox("setValue",o.name),$("#fldNewProductCategoryCode").textbox("setValue",o.code),$("#btnProductCategoryNewAdd").linkbutton("enable"),$("#dlgProductCategoryNew").dialog("setTitle","Modify "+o.name)),doTextboxFocus("fldNewProductCategoryName")}function t(e,t){0<t.data.rs.length?$("#btnProductCategoryNewAdd").linkbutton("disable"):$("#btnProductCategoryNewAdd").linkbutton("enable")}function c(e,t){$("#dlgProductCategoryNew").dialog("close")}function n(e,t){o=t.data.productcategory,a()}$("#divEvents").on("checkproductcategorycode",t),$("#divEvents").on("newproductcategory",c),$("#divEvents").on("saveproductcategory",c),$("#divEvents").on("loadproductcategory",n),$("#dlgProductCategoryNew").dialog({onClose:function(){$("#divEvents").off("checkproductcategorycode",t),$("#divEvents").off("newproductcategory",c),$("#divEvents").off("saveproductcategory",c),$("#divEvents").off("loadproductcategory",n)},onOpen:function(){$("#cbNewProductCategoryParent").combotree({valueField:"id",textField:"name",data:cache_productcategories}),$("#fldNewProductCategoryCode").textbox({onChange:function(e,t){_.isBlank(e)?$("#btnProductCategoryNewAdd").linkbutton("disable"):e!=t&&doServerDataMessage("checkproductcategorycode",{productcategoryid:d,code:e},{type:"refresh"})}}),r?$("#btnProductCategoryNewAdd").linkbutton({text:"Add"}):$("#btnProductCategoryNewAdd").linkbutton({text:"Save"}),_.isUndefined(d)||_.isNull(d)?a():doServerDataMessage("loadproductcategory",{productcategoryid:d},{type:"refresh"})},buttons:[{text:"Add",disabled:!0,id:"btnProductCategoryNewAdd",handler:function(){var e=doGetComboTreeSelectedId("cbNewProductCategoryParent"),t=$("#fldNewProductCategoryName").textbox("getValue"),o=$("#fldNewProductCategoryCode").textbox("getValue");_.isBlank(t)?doMandatoryTextbox("Please enter an category name","fldNewProductCategoryName"):_.isBlank(o)?doMandatoryTextbox("Please enter a unique category code","fldNewProductCategoryCode"):r?doServerDataMessage("newproductcategory",{parentid:e,name:t,code:o},{type:"refresh"}):doServerDataMessage("saveproductcategory",{productcategoryid:d,name:t,code:o},{type:"refresh"})}},{text:"Reset",handler:function(){a()}},{text:"Close",handler:function(){$("#dlgProductCategoryNew").dialog("close")}}]}).dialog("center").dialog("open")}