var accountsTabWidgetsLoaded=!1;function doAccountsTabSearch(e,o){doSearchCodeNameInTree("divAccountsTG",e)}function doAccountsTabWidgets(){function e(e,o){doServerMessage("listaccounts",{type:"refresh",accountid:o.data.accountid})}accountsTabWidgetsLoaded||(accountsTabWidgetsLoaded=!0,$("#divEvents").on("newaccount",e),$("#divEvents").on("saveaccount",e),$("#divEvents").on("changeaccountparent",e),$("#divEvents").on("expireaccount",e),$("#divEvents").on("listaccounts",function(e,o){doTreeReloadAndExpandToId("divAccountsTG",o.pdata.accountid)}),$("#divEvents").on("checkaccountcode",function(e,o){var t=o.data.rs;0<t.length&&doShowError("Account code ["+t[0].code+"] is already assigned to ["+t[0].name+"]")}),$("#divEvents").on("accountspopup",function(e,o){"newroot"==o?doDlgAccountNew(null,null):"new"==o?doTreeGridGetSelectedRowData("divAccountsTG",function(e){doDlgAccountNew(e.id,null)}):"clear"==o?$("#divAccountsTG").treegrid("unselectAll"):"remove"==o?doTreeGridGetSelectedRowData("divAccountsTG",function(o){doPromptYesNoCancel("Remove "+o.name+" and ALL subaccounts (Yes) or ONLY this account (No)?",function(e){_.isNull(e)||doServerDataMessage("expireaccount",{accountid:o.id,cascade:e},{type:"refresh"})})})||doShowError("Please select an account to remove"):"removeparent"==o&&doTreeGridGetSelectedRowData("divAccountsTG",function(e){doServerDataMessage("changeaccountparent",{accountid:e.id,parentid:null},{type:"refresh"})})}),$("#divAccountsTG").treegrid({idField:"id",treeField:"name",lines:!0,collapsible:!0,fitColumns:!1,autoRowHeight:!1,rownumbers:!0,striped:!0,toolbar:"#tbAccounts",showFooter:!0,sortName:"code",sortOrder:"asc",remoteSort:!1,multiSort:!0,loader:function(e,o,t){o({total:cache_accounts.length,rows:cache_accounts}),$(this).treegrid("reloadFooter",[{name:'<span class="totals_footer">'+doGetCountTreeArray(cache_accounts)+" Accounts</span>"}])},columns:[[{title:"Name",rowspan:2,field:"name",width:300,align:"left",resizable:!0,sortable:!0},{title:"Code",rowspan:2,field:"code",width:200,align:"left",resizable:!0,sortable:!0},{title:"Alt",colspan:2},{title:"Type",rowspan:2,field:"type",width:200,align:"left",resizable:!0,formatter:function(e,o){return doGetStringFromIdInObjArray(accounttypes,e)}},{title:"Modified",rowspan:2,field:"date",width:150,align:"right",resizable:!0,sortable:!0},{title:"By",rowspan:2,field:"by",width:200,align:"left",resizable:!0,sortable:!0}],[{title:"Name",field:"altname",width:300,align:"left",resizable:!0,styler:function(e,o,t){return"color: "+colour_olivedrab+"; background-color: "+colour_ghostwhite},sortable:!0},{title:"Code",field:"altcode",width:200,align:"left",resizable:!0,styler:function(e,o,t){return"color: "+colour_olivedrab+"; background-color: "+colour_ghostwhite},sortable:!0}]],onContextMenu:function(e,o){doTreeGridContextMenu("divAccountsTG","divAccountsMenuPopup",e,o)},onLoadSuccess:function(e,o){$(this).treegrid("enableDnd")},onBeforeDrag:function(e){return!0},onDragOver:function(e,o){return!_.isUN(e)},onBeforeDrop:function(e,o,t){return!0},onDrop:function(e,o,t){var n=_.isUN(e)?null:e.id;doServerDataMessage("changeaccountparent",{accountid:o.id,parentid:n},{type:"refresh"})},onDblClickCell:function(e,o){doDlgAccountNew(o.parentid,o.id)}}))}