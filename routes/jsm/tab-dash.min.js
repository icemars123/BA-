var dashTabWidgetsLoaded=!1;function doDashTabSendMessage(){var e=$("#cbDashChatRecipients").combobox("getValues"),t=$("#fldDashChatMessage").textbox("getValue");_.isBlank(t)||doServerDataMessage("chatmsg",{recipients:e,msg:t},{type:"refresh"})}function doDashTabWidgets(){var r=[],d=[],i=[];if(!dashTabWidgetsLoaded){$("#divEvents").on("orderstatusalert",function(e,t){doServerMessage("listalertsforme",{type:"refresh"})}),$("#divEvents").on("listalertsforme",function(e,t){d=[],t.data.rs.forEach(function(e){d.push({id:doNiceId(e.id),orderno:doNiceString(e.orderno),majorstatus:doGetStringFromIdInObjArray(orderstatustypes,e.status),by:doNiceString(e.usercreated),date:doNiceDate(e.datecreated)})}),$("#divMyAlerts").datagrid("loadData",d)}),$("#divEvents").on("listusers",function(e,t){$("#cbDashChatRecipients").combobox("loadData",cache_users)}),$("#divEvents").on("listchatsforme",function(e,t){r=[],t.data.rs.forEach(function(e){r.push({id:doNiceId(e.id),message:doNiceComments(e.msg),date:e.datecreated,sender:e.senderuuid,recipient:e.recipientuuid,from:doNiceTitleizeString(e.sendername),to:doNiceTitleizeString(e.recipientname)})}),$("#divChatG").datagrid("loadData",r)}),$("#divEvents").on("listorders",function(e,t){i=[],t.data.rs.forEach(function(e){i.push({id:doNiceId(e.id),orderno:doNiceString(e.orderno),name:doNiceString(e.name),pono:doNiceString(e.pono),attachmentid:doNiceId(e.attachmentid),attachmentname:doNiceString(e.attachmentname),attachmentimage:doNiceString(e.attachmentimage),majorstatus:doGetStringFromIdInObjArray(orderstatustypes,e.majorstatus),startdate:_.nicedatetodisplay(e.startdate),enddate:_.nicedatetodisplay(e.enddate),date:doNiceDateModifiedOrCreated(e.datemodified,e.datecreated),by:doNiceModifiedBy(e.datemodified,e.usermodified,e.usercreated)})}),$("#divDashOrdersG").datagrid("loadData",i)}),$("#divEvents").on("neworder",t),$("#divEvents").on("saveorder",t),$("#divEvents").on("expireorder",t),$("#divEvents").on("saveorderattachment",t),$("#divEvents").on("expireorderattachment",t),$("#divEvents").on("ordercreated",t),$("#divEvents").on("ordersaved",t),$("#divEvents").on("orderexpired",t),$("#divEvents").on("orderstatuscreated",t),$("#divEvents").on("orderattachmentcreated",t),$("#divEvents").on("orderattachmentsaved",t),$("#divEvents").on("orderattachmentexpired",t),$("#divEvents").on("chatmsg",function(e,t){$("#fldDashChatMessage").textbox("clear"),$("#cbDashChatRecipients").combobox("clear")}),$("#divEvents").on("newchatmsg",function(e,t){doServerMessage("listchatsforme",{type:"refresh"}),doShowChat("New message(s)")}),$("#divEvents").on("useronline",function(e,t){t.data.uuid!=uuid&&doShowInfo("["+t.data.uname+"] is now online...")}),$("#divEvents").on("useroffline",function(e,t){doShowInfo("["+t.data.uname+"] is now onffline...")}),$("#divEvents").on("userlogout",function(e,t){doShowInfo("["+t.data.uname+"] has logged out...")}),dashTabWidgetsLoaded=!0;var e=$.extend({},$.fn.datagrid.defaults.view,{renderRow:function(e,t,d,r,i){var a=[];if(_.isUndefined(i)||_.isUndefined(i.id))a.push('<td style="width: 800px; padding: 5px 5px; border: 0;">&nbsp;</td>');else{var o="",n=_.isUndefined(i.attachmentimage)||_.isNull(i.attachmentimage)||_.isBlank(i.attachmentimage)?'<td width="200px">&nbsp;</td>':'  <td width="200px"><img src="'+i.attachmentimage+'" style="width: 200px;"/></td>';if(!_.isNull(i.enddate)&&!_.isBlank(i.enddate)){var s=moment(i.enddate),l=moment(i.enddate).format("dddd MMMM Do YYYY");if(moment().isAfter(s)&&(l='<span style="color: red"><strong>'+l+"</strong></span>"),o="    <tr><td>Required By: </td><td>"+l+"</td></tr>",!_.isNull(i.startdate)&&!_.isBlank(i.startdate)){var c=moment(i.enddate).diff(i.startdate,"days"),u=moment().diff(i.startdate,"days"),m=Math.round(100*u/c);100<m&&(m=100),o+='          <tr><td>Progress: </td><td>            <div style="width: 50%; border: 1px solid #ccc">              <div style="width: '+m+"%; background: "+colour_mistyrose+'; color: black">'+m+"%</div>            </div></td>          </tr>"}}a.push('<td style="width: 800px; height: 210px; padding: 5px 5px; border: 0;">  <table style="border: 0">    <tr>'+n+'      <td>        <table style="border: 0">          <tr><td style="width: 180px">Name: </td><td>'+i.name+"</td></tr>          <tr><td>Order #: </td><td>"+i.orderno+"</td></tr>          <tr><td>P.O. #: </td><td>"+i.pono+'</td></tr>          <tr><td>Status: </td><td style="color: '+colour_olivedrab+'">'+i.majorstatus+"</td></tr>"+o+"          <tr><td>Modified: </td><td>"+i.date+"</td></tr>          <tr><td>By: </td><td>"+i.by+"</td></tr>        </table>      </td>    </tr>  </table></td>")}return a.join("")}});$("#divDashOrdersG").datagrid({idField:"id",fitColumns:!0,singleSelect:!0,rownumbers:!1,loader:function(e,t,d){t({total:i.length,rows:i})},view:e,onDblClickRow:function(e,t){doSelectSalesTab("Orders",t.id)}}),$("#divMyAlerts").datagrid({idField:"id",groupField:"orderno",fitColumns:!1,singleSelect:!1,rownumbers:!1,striped:!0,view:groupview,columns:[[{title:"Order No",field:"orderno",width:200,align:"left",resizable:!0},{title:"Status",field:"majorstatus",width:200,align:"left",resizable:!0},{title:"By",field:"by",width:200,align:"left",resizable:!0},{title:"Date",field:"date",width:150,align:"right",resizable:!0}]],groupFormatter:function(e,t){return e+" - "+t.length+" Statuses"}}),$("#cbDashChatRecipients").combobox({valueField:"uuid",textField:"name",data:cache_users,multiple:!0}),$("#divChatG").datagrid({idField:"id",fitColumns:!1,singleSelect:!0,rownumbers:!0,striped:!0,loader:function(e,t,d){t({total:r.length,rows:r})},frozenColumns:[[{title:"From",field:"from",width:200,align:"left",resizable:!0,styler:function(e,t,d){return t.sender==uuid?"color: "+colour_dodgerblue:"color: #000000"},formatter:function(e,t,d){return t.sender==uuid?"Me":e}}]],columns:[[{title:"Message",field:"message",width:400,align:"left",resizable:!0},{title:"When",field:"date",width:150,align:"right",resizable:!0,formatter:function(e,t,d){return moment(e).fromNow()}},{title:"To",field:"to",width:150,align:"right",resizable:!0,styler:function(e,t,d){return t.recipient==uuid?"color: "+colour_dodgerblue:"color: #000000"},formatter:function(e,t,d){return t.recipient==uuid?"Me":t.to}}]]}),doServerMessage("listchatsforme",{type:"refresh"}),doServerMessage("listalertsforme",{type:"refresh"}),doServerMessage("listorders",{type:"refresh"})}function t(e,t){doServerMessage("listorders",{type:"refresh"})}}