var clientsTabWidgetsLoaded=!1;function doClientsTabSearch(e,t){doSearchCodeNameInTree("divClientsTG",e)}function doClientsTabWidgets(){function i(e,t){var i={type:"refresh"};_.isUN(t)||(i.clientid=t.data.clientid),doLinkButtonSelected("tbClientsShowActive")?doServerDataMessage("listclients",{showinactive:!1},i):doLinkButtonSelected("tbClientsShowInActive")?doServerDataMessage("listclients",{showinactive:!0},i):doServerMessage("listclients",i)}clientsTabWidgetsLoaded||(clientsTabWidgetsLoaded=!0,$("#divEvents").on("listclients",function(e,t){$("#divClientsTG").treegrid("reload"),doExpandTreeToId("divClientsTG",t.pdata.clientid)}),$("#divEvents").on("newclient",i),$("#divEvents").on("saveclient",i),$("#divEvents").on("expireclient",i),$("#divEvents").on("changeclientparent",i),$("#divEvents").on("clientcreated",i),$("#divEvents").on("clientsaved",i),$("#divEvents").on("clientexpired",i),$("#divEvents").on("clientparentchanged",i),$("#divEvents").on("savesupplier",i),$("#divEvents").on("suppliersaved",i),$("#divEvents").on("checkclientcode",function(e,t){var i=t.data.rs;0<i.length&&doShowError("Client code ["+i[0].code+"] is already assigned to ["+i[0].name+"]")}),$("#divEvents").on("clientspopup",function(e,t){"newroot"==t?doDlgClientNew(null,null):"new"==t?doTreeGridGetSelectedRowData("divClientsTG",function(e){doDlgClientNew(e.id,null)}):"clear"==t?$("#divClientsTG").treegrid("unselectAll"):"remove"==t?function(){var e=$("#divClientsTG").datagrid("getSelections");if(0==e.length)doShowError("Please select one or more clients to remove");else if(1==e.length){var t=e[0];doPromptYesNoCancel("Remove "+t.name+" and ALL subclients (Yes) or ONLY this client (No)?",function(e){_.isNull(e)||doServerDataMessage("expireclient",{clientid:t.id,cascade:e},{type:"refresh"})})}else doPromptOkCancel("Remove "+e.length+" clients and ALL their subclients?",function(t){_.isNull(t)||e.forEach(function(e){doServerDataMessage("expireclient",{clientid:e.id,cascade:t},{type:"refresh"})})})}():"refresh"==t?i(0,null):"search"==t?doDlgClientSearch():"removeparent"==t?doTreeGridGetSelectedRowData("divClientsTG",function(e){doServerDataMessage("changeclientparent",{clientid:e.id,parentid:null},{type:"refresh"})}):"neworder"==t?doTreeGridGetSelectedRowData("divClientsTG",function(e){$("#divEvents").trigger("new-client-order",e)})||doShowError("Please select a client to create order for"):"showactive"==t?doServerDataMessage("listclients",{showinactive:!1},{type:"refresh"}):"showinactive"==t?doServerDataMessage("listclients",{showinactive:!0},{type:"refresh"}):"showall"==t&&doServerMessage("listclients",{type:"refresh"})}),$("#divClientsTG").treegrid({idField:"id",treeField:"name",lines:!0,collapsible:!0,fitColumns:!1,singleSelect:!0,autoRowHeight:!1,rownumbers:!0,striped:!0,toolbar:"#tbClients",showFooter:!0,sortName:"name",sortOrder:"asc",remoteSort:!1,multiSort:!0,loader:function(e,t,i){t({total:cache_clients.length,rows:cache_clients}),$(this).treegrid("reloadFooter",[{name:'<span class="totals_footer">'+doGetCountTreeArray(cache_clients)+" Clients</span>"}])},frozenColumns:[[{title:"Name",field:"name",width:300,align:"left",resizable:!0,sortable:!0},{title:"Code",field:"code",width:200,align:"left",resizable:!0,sortable:!0}]],columns:[[{title:"Active",field:"isactive",width:80,align:"center",resizable:!0,formatter:function(e,t){return mapBoolToImage(e)}},{title:"Modified",field:"date",width:150,align:"right",resizable:!0,sortable:!0},{title:"By",field:"by",width:200,align:"left",resizable:!0,sortable:!0}]],onContextMenu:function(e,t){doTreeGridContextMenu("divClientsTG","divClientsMenuPopup",e,t)},onLoadSuccess:function(e){$(this).treegrid("enableDnd")},onBeforeDrag:function(e){return!0},onDragOver:function(e,t){return!_.isUN(e)},onBeforeDrop:function(e,t,i){return!0},onDrop:function(e,t,i){var n=_.isUN(e)?null:e.id;doServerDataMessage("changeclientparent",{clientid:t.id,parentid:n},{type:"refresh"})},onDblClickCell:function(e,t){doDlgClientNew(t.parentid,t.id)}}))}