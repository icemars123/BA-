function doDlgProductSearch(d){function e(e,t){var o=[];t.data.rs.forEach(function(e){o.push({id:doNiceId(e.id),name:doNiceString(e.name),code:doNiceString(e.code),barcode:doNiceString(e.altcode),categoryid:doNiceId(e.productcategoryid),category:doNiceString(e.productcategoryname)})}),$("#divProductSelectG").datagrid("loadData",o),$("#divProductSelectG").datagrid("reloadFooter",[{category:'<span class="totals_footer">'+o.length+" found</span>"}])}$("#divEvents").on("productsearch",e),$("#dlgProductSearch").dialog({onClose:function(){$("#divEvents").off("productsearch",e)},onOpen:function(){$("#fldSearchProductText").textbox({iconCls:"icon-product",iconAlign:"left",onChange:function(e,t){var o=$("#cbSearchOrderMaxHistory").combobox("getValue");doServerDataMessage("productsearch",{value:e,maxhistory:o},{type:"refresh"})}}),$("#divProductSelectG").datagrid({idField:"id",fitColumns:!1,singleSelect:!0,rownumbers:!0,striped:!0,showFooter:!0,columns:[[{title:"Category",field:"category",width:200,align:"left",resizable:!0},{title:"Code",field:"code",width:200,align:"left",resizable:!0},{title:"Name",field:"name",width:300,align:"left",resizable:!0},{title:"Barcode",field:"barcode",width:100,align:"left",resizable:!0}]],onDblClickCell:function(e,t,o){doGridGetSelectedRowData("divProductSelectG",function(e){_.isUndefined(d)||_.isNull(d)||d(e)}),$("#dlgProductSearch").dialog("close")}}),doTextboxFocus("fldSearchProductText")},buttons:[{text:"Select",handler:function(){if(!_.isUndefined(d)&&!_.isNull(d)){var e=$("#divProductSelectG").datagrid("getSelected");e?(d(e),$("#dlgProductSearch").dialog("close")):noty({text:"Please select a product...",type:"error",timeout:4e3})}}},{text:"Close",handler:function(){$("#dlgProductSearch").dialog("close")}}]}).dialog("center").dialog("open")}