var journalsTabWidgetsLoaded=!1;function doJournalsTabWidgets(){function e(){doServerMessage("listjournals",{type:"refresh"})}journalsTabWidgetsLoaded||(journalsTabWidgetsLoaded=!0,$("#divEvents").on("listjournals",function(e,t){var i=[];t.data.rs.forEach(function(e){i.push({id:doNiceId(e.id),journalno:doNiceString(e.journalno),debitaccountid:doNiceId(e.debitaccountid),creditaccountid:doNiceId(e.creditaccountid),type:e.itype,amount:_.formatnumber(e.amount,4),taxcodeid:doNiceId(e.taxcodeid),refno:doNiceString(e.refno),comments:doNiceString(e.comments),otherid:doNiceId(e.otherid),debitaccountcode:doNiceString(e.debitaccountcode),debitaccountname:doNiceString(e.debitaccountname),creditaccountcode:doNiceString(e.creditaccountcode),creditaccountname:doNiceString(e.creditaccountname),otherno:doNiceString(e.otherno),actual:doNiceDate(e.dateactual),created:doNiceDate(e.datecreated),by:doNiceTitleizeString(e.usercreated)})}),$("#divJournalsG").datagrid("loadData",i)}),$("#divEvents").on("newjournal",e),$("#divEvents").on("pordercompleted",e),$("#divEvents").on("orderpaid",e),$("#divEvents").on("testjournal",function(e,t){var i="Debits: <br />";t.data.rs1.forEach(function(e){i+=e.typename+": "+e.debits+"<br />"}),i+="<br />Credits: <br />",t.data.rs2.forEach(function(e){i+=e.typename+": "+e.credits+"<br />"}),doShowInfo(i)}),$("#divEvents").on("journalspopup",function(e,t){"new"==t?doDlgJournalNew():"clear"==t?$("#divJournalsG").datagrid("clearSelections"):"reset"==t?doServerMessage("listjournals",{type:"refresh"}):"search"==t||"test"==t&&primus.emit("testjournal",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),$("#dtJournalFrom").datebox(),$("#dtJournalTo").datebox(),$("#divJournalsG").datagrid({idField:"id",fitColumns:!1,singleSelect:!0,rownumbers:!0,striped:!0,toolbar:"#tbJournal",columns:[[{title:"Journal No.",rowspan:2,field:"journalno",width:150,align:"left",resizable:!0},{title:"Debit",colspan:2},{title:"Credit",colspan:2},{title:"Type",rowspan:2,field:"type",width:150,align:"left",resizable:!0,formatter:function(e,t,i){return doGetStringFromIdInObjArray(journaltypes,e)}},{title:"Amount",rowspan:2,field:"amount",width:100,align:"right",resizable:!0,formatter:function(e,t,i){return _.niceformatnumber(e)}},{title:"TaxCode",rowspan:2,field:"taxcodeid",width:200,align:"left",resizable:!0,formatter:function(e,t,i){return doGetStringFromIdInObjArray(cache_taxcodes,e)}},{title:"Reference No.",rowspan:2,field:"refno",width:150,align:"left",resizable:!0},{title:"Date",colspan:3}],[{title:"Name",field:"debitaccountid",width:200,align:"left",resizable:!0,formatter:function(e,t,i){return doGetNameFromTreeArray(cache_accounts,t.debitaccountid)},styler:function(e,t,i){return"color: "+colour_indianred}},{title:"Code",field:"debitaccountcode",width:100,align:"left",resizable:!0,styler:function(e,t,i){return"color: "+colour_indianred}},{title:"Name",field:"creditaccountid",width:200,align:"left",resizable:!0,formatter:function(e,t,i){return doGetNameFromTreeArray(cache_accounts,t.creditaccountid)},styler:function(e,t,i){return"color: "+colour_steelblue}},{title:"Code",field:"creditaccountcode",width:100,align:"left",resizable:!0,styler:function(e,t,i){return"color: "+colour_steelblue}},{title:"Active",field:"actual",width:150,align:"right",resizable:!0,styler:function(e,t,i){if(e!=t.created)return"color: "+colour_orangered}},{title:"Created",field:"created",width:150,align:"right",resizable:!0},{title:"By",field:"by",width:200,align:"left",resizable:!0}]]}),doServerMessage("listjournals",{type:"refresh"}))}