var exchangeratesTabWidgetsLoaded=!1;function doExchangeRatesTabWidgets(){var a=null;exchangeratesTabWidgetsLoaded||($("#divEvents").on("listexchangerates",function(e,t){$("#divExchangeRatesG").datagrid("reload"),_.isUndefined(t.pdata.exchangerateid)||_.isNull(t.pdata.exchangerateid)||$("#divExchangeRatesG").datagrid("selectRecord",t.pdata.exchangerateid)}),$("#divEvents").on("newexchangerate",function(e,t){primus.emit("listexchangerates",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh",exchangerateid:t.data.exchangerateid}})}),$("#divEvents").on("saveexchangerate",function(e,t){primus.emit("listexchangerates",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh",exchangerateid:t.data.exchangerateid}})}),$("#divEvents").on("expireexchangerate",function(e,t){primus.emit("listexchangerates",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),$("#divEvents").on("changeratecreated",function(e,t){primus.emit("listexchangerates",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),$("#divEvents").on("exchangeratesaved",function(e,t){primus.emit("listexchangerates",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),$("#divEvents").on("exchangerateeexpired",function(e,t){primus.emit("listexchangerates",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),$("#divEvents").on("exchangeratespopup",function(e,t){var i;"new"==t?primus.emit("newexchangerate",{fguid:fguid,uuid:uuid,session:session,name:"New Exchange Rate",pdata:{type:"refresh"}}):"clear"==t?$("#divExchangeRatesG").datagrid("clearSelections"):"edit"==t?doGridStartEdit("divExchangeRatesG",a,function(e,t){a=t,doGridGetEditor("divExchangeRatesG",a,"name",function(e){})}):"cancel"==t?a=doGridCancelEdit("divExchangeRatesG",a):"save"==t?(editingExchangeRateIndex("divExchangeRatesG",a,function(e){primus.emit("saveexchangerate",{fguid:fguid,uuid:uuid,session:session,exchangerateid:e.id,name:e.name,provider:e.provider,currency:e.currency,rate:e.rate,pdata:{type:"refresh"}})}),a=null):"remove"==t?(i=$("#divExchangeRatesG").datagrid("getSelected"))?doPromptOkCancel("Remove "+i.name+"?",function(e){e&&primus.emit("expireexchangerate",{fguid:fguid,uuid:uuid,session:session,exchangerateid:i.id,pdata:{type:"refresh"}})}):noty({text:"Please select an exchange rate to remove",type:"error",timeout:4e3}):"lookup"==t&&(doGridGetSelectedRowData("divExchangeRatesG",a,function(e){doDlgSelectRate(function(e){$("#divExchangeRatesG").datagrid("updateRow",{index:a,row:{currency:e.currency,rate:e.rate}}),a=a,doExchangeRatesSave()})})||noty({text:"Please select a rate ti lookup",type:"error",timeout:4e3}))}),exchangeratesTabWidgetsLoaded=!0,$("#divExchangeRatesG").datagrid({idField:"id",fitColumns:!1,singleSelect:!0,rownumbers:!0,striped:!0,toolbar:"#tbExchangeRates",loader:function(e,t,i){t({total:cache_exchangerates.length,rows:cache_exchangerates})},frozenColumns:[[{title:"Name",field:"name",width:300,align:"left",resizable:!0,editor:"text"}]],columns:[[{title:"Provider",field:"provider",width:200,align:"left",resizable:!0,editor:"text"},{title:"Currency",field:"currency",width:100,align:"left",resizable:!0,editor:"text"},{title:"Rate",field:"rate",width:100,align:"right",resizable:!0,editor:{type:"numberbox",options:{precision:4}}},{title:"Modified",field:"date",width:150,align:"right",resizable:!0},{title:"By",field:"by",width:200,align:"left",resizable:!0}]],onRowContextMenu:function(e,t,i){doGridContextMenu("divExchangeRatesG","divExchangeRatesMenuPopup",e,t,i)},onDblClickCell:function(e,i,t){doGridStartEdit("divExchangeRatesG",a,function(e,t){a=t,-1!=["modified","by"].indexOf(i)&&(i="name"),doGridGetEditor("editingExchangeRateIndex",a,i,function(e){})})}}))}