function doDlgJournalNew(){var n=null,e=[{text:"New",iconCls:"icon-add",handler:function(){o(),$("#divJournalNewG").datagrid("appendRow",{})}},{text:"Clear",iconCls:"icon-clear",handler:function(){$("#divJournalNewG").datagrid("clearSelections")}},{text:"Edit",iconCls:"icon-edit",handler:function(){doGridGetSelectedRowData("divJournalNewG",function(e){doGridStartEdit("divJournalNewG",n,function(e,o){n=o,doGridGetEditor("divJournalNewG",n,"amount",function(e){})})})}},{text:"Cancel",iconCls:"icon-cancel",handler:function(){n=doGridCancelEdit("divJournalNewG",n)}},{text:"Save",iconCls:"icon-save",handler:o},{text:"Remove",iconCls:"icon-remove",handler:function(){doGridGetSelectedRowData("divJournalNewG",function(e,o){doPromptOkCancel("Remove entry?",function(e){e&&($("#divJournalNewG").datagrid("deleteRow",o),doGridCalcTotals("divJournalNewG","amount"))})})||doShowError("Please select an entry to remove")}}];function o(){doGridEndEditGetRow("divJournalNewG",n,function(e){doGridCalcTotals("divJournalNewG","amount")}),n=null}function t(){$("#cbJournalNewType").combobox("clear"),$("#fldJournalNewRefno").textbox("clear"),$("#fldJournalNewComment").textbox("clear"),$("#divJournalNewG").datagrid("loadData",[]),doTextboxFocus("cbJournalNewType")}function a(e,o){$("#dlgJournalNew").dialog("close")}$("#divEvents").on("newjournal",a),$("#dlgJournalNew").dialog({onClose:function(){$("#divEvents").off("newjournal",a)},onOpen:function(){$("#cbJournalNewType").combobox({valueField:"id",textField:"name",data:journaltypes}),$("#divJournalNewG").datagrid({fitColumns:!0,singleSelect:!0,rownumbers:!0,striped:!0,toolbar:e,showFooter:!0,columns:[[{title:"Debit Account",field:"debitaccountid",width:300,align:"left",resizable:!0,editor:{type:"combotree",options:{valueField:"id",textField:"name",data:cache_accounts,onSelect:function(e){}}},formatter:function(e,o){return doGetNameFromTreeArray(cache_accounts,e)}},{title:"Credit Account",field:"creditaccountid",width:300,align:"left",resizable:!0,editor:{type:"combotree",options:{valueField:"id",textField:"name",data:cache_accounts,onSelect:function(e){}}},formatter:function(e,o){return doGetNameFromTreeArray(cache_accounts,e)}},{title:"Amount",field:"amount",width:100,align:"right",resizable:!0,editor:{type:"numberbox",options:{precision:4}}},{title:"Tax Code",field:"taxcodeid",width:200,align:"left",resizable:!0,editor:{type:"combobox",options:{valueField:"id",textField:"name",data:cache_taxcodes,onSelect:function(e){}}},formatter:function(e,o){return doGetStringFromIdInObjArray(cache_taxcodes,e)}}]],onDblClickCell:function(e,o,t){doGridGetSelectedRowData("divJournalNewG",function(e){doGridStartEdit("divJournalNewG",n,function(e,o){n=o,doGridGetEditor("divJournalNewG",n,"amount",function(e){})})})}}),t()},buttons:[{text:"Add",handler:function(){var e=$("#cbJournalNewType").combobox("getValue"),o=$("#fldJournalNewRefno").textbox("getValue"),t=$("#fldJournalNewComment").textbox("getValue");if(_.isBlank(e))doShowError("Please select a journal entry type");else{var n=$("#divJournalNewG").datagrid("getData"),a=null,i=[];n.rows.forEach(function(e,o){_.isBlank(e.debitaccountid)||_.isBlank(e.creditaccountid)||_.isBlank(e.amount)||0==e.amount?_.isNull(a)&&(a=o):i.push({debitaccountid:e.debitaccountid,creditaccountid:e.creditaccountid,amount:e.amount,taxcodeid:e.taxcodeid})}),_.isNull(a)?doServerDataMessage("newjournal",{type:e,refno:o,comments:t,entries:i},{type:"refresh"}):(doShowError("Entry must have a debit/credit account and a non zero amount"),$("#divJournalNewG").datagrid("selectRow",a))}}},{text:"Reset",handler:function(){t()}},{text:"Close",handler:function(){$("#dlgJournalNew").dialog("close")}}]}).dialog("center").dialog("open")}