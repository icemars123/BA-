function addChannels(i){_.isArray(i)?i.forEach(function(i){-1==channels.indexOf(i)&&channels.push(i)}):-1==channels.indexOf(i)&&channels.push(i)}function doJoinChannels(){_.isUndefined(channels)||_.isNull(channels)||channels.forEach(function(i){primus.emit("join",{fguid:fguid,uuid:uuid,session:session,channel:i,pdata:"join"})})}function doPrimus(){try{primus=new Primus(server,{reconnect:{maxDelay:15e3,minDelay:1e3,retries:1e3},strategy:["disconnect","timeout"]}),primus.on("error",function(i){$("#divDashConnectionStatus").html('<img style="vertical-align: middle;" src="data:image/png;base64,'+b64disconnected+'" width="24" height="24"/> Oops, server may be lost...'),connected=!1}),primus.on("open",function(){$("#divDashConnectionStatus").html(document.createTextNode("Connected to server...")),connected=!0,firstconnection&&(firstconnection=!1),doJoinChannels()}),primus.on("close",function(){$("#divDashConnectionStatus").html('<img style="vertical-align: middle;" src="data:image/png;base64,'+b64disconnected+'" width="24" height="24"/> OK, server has gone away, don\'t worry, will look for it shortly...')}),primus.on("end",function(){}),primus.on("reconnecting",function(i){var e=i.timeout/1e3;$("#divDashConnectionStatus").html('<img style="vertical-align: middle;" src="data:image/png;base64,'+b64searching+'" width="24" height="24"/> Sending search party for server in '+e.toFixed(0)+"s, retry "+i.attempt+" of "+i.retries)}),primus.on("reconnect",function(){$("#divDashConnectionStatus").html('<img style="vertical-align: middle;" src="data:image/png;base64,'+b64gears+'" width="24" height="24"/> Looking for server now...')}),primus.on("welcome",function(i){fguid=i.fguid,addChannels(i.channel),showIdle()}),primus.on("join",function(i){i.pdata}),primus.on("login",function(i){uid=i.uid,uname=i.uname,uuid=i.uuid,isadmin=i.isadmin,isclient=i.isclient,clientid=i.clientid,myperms=i.permissions,session=i.session,addChannels(i.channels),doJoinChannels(),$("#spnMenu").html("Logged in as <strong>"+_.titleize(uname)+"</strong>"),$("#spnServer").text(server),$("#divEvents").trigger("refresh-all",{pdata:"none"}),$("#dlgLogin").dialog("close"),doOrdersTabWidgets()}),primus.on("getclient",function(i){var e=i.pdata||"";if(!(_.isUndefined(i.client)||_.isNull(i.client)||_.isUndefined(e.callback)||_.isNull(e.callback))){var t=window[e.callback];if(_.isFunction(t))t({id:doNiceId(i.client.id),parentid:doNiceId(i.client.parentid),parentname:doNiceString(i.client.parentname),code:doNiceString(i.client.code),name:doNiceString(i.client.name),url1:doNiceString(i.client.url1),email1:doNiceString(i.client.email1),phone1:doNiceString(i.client.phone1),fax1:doNiceString(i.client.fax1),contact1:doNiceString(i.client.contact1),address1:doNiceString(i.client.address1),address2:doNiceString(i.client.address2),city:doNiceString(i.client.city),state:doNiceString(i.client.state),postcode:doNiceString(i.client.postcode),country:doNiceString(i.client.country),contact2:doNiceString(i.client.contact2),shipaddress1:doNiceString(i.client.shipaddress1),shipaddress2:doNiceString(i.client.shipaddress2),shipcity:doNiceString(i.client.shipcity),shipstate:doNiceString(i.client.shipstate),shippostcode:doNiceString(i.client.shippostcode),shipcountry:doNiceString(i.client.shipcountry),bankname:doNiceString(i.client.banekname),bankbsb:doNiceString(i.client.bankbsb),bankaccountno:doNiceString(i.client.bankaccountno),bankaccountname:doNiceString(i.client.bankaccountname),dayscredit:i.client.dayscredit,linelimit:_.formatnumber(i.client.linelimit,4),orderlimit:_.formatnumber(i.client.orderlimit,4),creditlimit:_.formatnumber(i.client.creditlimit,4),invoicetemplateid:doNiceId(i.client.invoicetemplateid),ordertemplateid:doNiceId(i.client.ordertemplateid),quotetemplateid:doNiceId(i.client.quotetemplateid),deliverydockettemplateid:doNiceId(i.deliverydockettemplateid),labeltemplateid:doNiceId(i.labeltemplateid),isactive:i.client.isactive,date:doNiceDateModifiedOrCreated(i.client.datemodified,i.client.datecreated),by:doNiceModifiedBy(i.client.datemodified,i.client.usermodified,i.client.usercreated)},e)}}),primus.on("listemails",function(i){var e=i.pdata||"";if(!(_.isUndefined(i.rs)||_.isNull(i.rs)||_.isUndefined(e.callback)||_.isNull(e.callback))){var t=window[e.callback];_.isFunction(t)&&t(i.rs,e)}}),primus.on("listclientnotes",function(i){var e=i.pdata||"";_.isUndefined(i.rs)||_.isNull(i.rs)||(cache_clientnotes=[],i.rs.forEach(function(i){cache_clientnotes.push({id:doNiceId(i.id),notes:doNiceString(i.notes),date:doNiceDateModifiedOrCreated(i.datemodified,i.datecreated),by:doNiceModifiedBy(i.datemodified,i.usermodified,i.usercreated)})}),refreshFromCacheClientNotes(e))}),primus.on("newclientnote",function(i){i.pdata;primus.emit("listclientnotes",{fguid:fguid,uuid:uuid,session:session,clientid:i.clientid,pdata:{type:"refresh",clientnoteid:i.clientnoteid}})}),primus.on("saveclientnote",function(i){i.pdata;primus.emit("listclientnotes",{fguid:fguid,uuid:uuid,session:session,clientid:i.clientid,pdata:{type:"refresh",clientnoteid:i.clientnoteid}})}),primus.on("listclientattachments",function(i){var e=i.pdata||"";_.isUndefined(i.rs)||_.isNull(i.rs)||(cache_clientattachments=[],i.rs.forEach(function(i){cache_clientattachments.push({id:doNiceId(i.id),name:doNiceString(i.name),description:doNiceString(i.description),mimetype:'<a href="javascript:void(0);" onClick="doThrowClientAttachment('+i.id+');">'+mapMimeTypeToImage(i.mimetype)+"</a>",size:doNiceString(i.size),image:doNiceString(i.image),date:doNiceDateModifiedOrCreated(i.datemodified,i.datecreated),by:doNiceModifiedBy(i.datemodified,i.usermodified,i.usercreated)})}),refreshFromCacheClientAttachments(e))}),primus.on("saveclientattachment",function(i){i.pdata;primus.emit("listclientattachments",{fguid:fguid,uuid:uuid,session:session,clientid:i.clientid,pdata:{type:"refresh"}})}),primus.on("expireclientattachment",function(i){i.pdata;primus.emit("listclientattachments",{fguid:fguid,uuid:uuid,session:session,clientid:i.clientid,pdata:{type:"refresh"}})}),primus.on("newuser",function(i){i.pdata;primus.emit("listusers",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh",useruuid:i.useruuid}}),noty({text:"User created with password <strong>"+i.pwd+"</strong>",type:"success"})}),primus.on("saveuser",function(i){i.pdata;primus.emit("listusers",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh",useruuid:i.useruuid}})}),primus.on("expireuser",function(i){i.pdata;primus.emit("listusers",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh",useruuid:i.useruuid}})}),primus.on("changpassword",function(i){i.pdata;noty({text:"Password successfully changed",type:"success",timeout:4e3})}),primus.on("listusers",function(i){var e=i.pdata||"";doUpdateInitTasksProgress(),_.isUndefined(i.rs)||_.isNull(i.rs)||(cache_users=[],i.rs.forEach(function(i){var e=i.uuid==uuid?mapUserStatusToImage("online"):mapUserStatusToImage("unknown");cache_users.push({uuid:doNiceString(i.uuid),name:doNiceString(i.uname),username:doNiceString(i.uid),email:doNiceString(i.email),phone:doNiceString(i.phone),isadmin:i.isadmin,avatar:doNiceString(i.avatar),canvieworders:i.canvieworders,cancreateorders:i.cancreateorders,canviewinvoices:i.canviewinvoices,cancreateinvoices:i.cancreateinvoices,canviewinventory:i.canviewinventory,cancreateinventory:i.cancreateinventory,canviewpayroll:i.canviewpayroll,cancreatepayroll:i.cancreatepayroll,canviewproducts:i.canviewproducts,cancreateproducts:i.cancreateproducts,canviewclients:i.canviewclients,cancreateclients:i.cancreateclients,canviewcodes:i.canviewcodes,cancreatecodes:i.cancreatecodes,date:doNiceDateModifiedOrCreated(i.datemodified,i.datecreated),by:doNiceModifiedBy(i.datemodified,i.usermodified,i.usercreated),status:e})}),refreshFromCacheUsers(e)),primus.emit("listconnectedusers",{fguid:fguid,uuid:uuid,session:session,pdata:"refresh-all"})}),primus.on("listconnectedusers",function(i){i.pdata;_.isUndefined(i.rs)||_.isNull(i.rs)||i.rs.forEach(function(i){})}),primus.on("saveuserpermissions",function(i){i.pdata}),primus.on("listinvoices",function(i){i.pdata;doUpdateInitTasksProgress(),_.isUndefined(i.rs)||_.isNull(i.rs)||(cache_invoices=[],i.rs.forEach(function(i){i.clientid==theclientid&&cache_invoices.push({id:doNiceId(i.id),clientid:doNiceId(i.clientid),clientname:doNiceString(i.clientname),name:doNiceString(i.name),pono:doNiceString(i.pono),invoiceno:doNiceString(i.invoiceno),orderno:doNiceString(i.orderno),copyno:i.copyno,totalprice:_.sanitiseAsNumeric(i.totalprice,4),dayscredit:i.dayscredit,orderlimit:_.formatnumber(i.orderlimit,4),creditlimit:_.formatnumber(i.creditlimit,4),date:doNiceDate(i.invoicedate),by:_.titleize(i.userinvoiced)})}))}),primus.on("listinvoicesbyclient",function(i){var e=i.pdata||"";_.isUndefined(i.rs)||_.isNull(i.rs)||(cache_clientinvoices=[],i.rs.forEach(function(i){cache_clientinvoices.push({id:doNiceId(i.id),clientid:doNiceId(i.clientid),clientname:doNiceString(i.clientname),name:doNiceString(i.name),pono:doNiceString(i.pono),invoiceno:doNiceString(i.invoiceno),orderno:doNiceString(i.orderno),totalprice:_.formatnumber(i.totalprice,4),totalgst:_.formatnumber(i.totalgst,4),date:doNiceDate(i.invoicedate)})}),refreshFromCacheClientInvoices(e))}),primus.on("printinvoices",function(i){i.pdata;_.isUndefined(i.rs)||_.isNull(i.rs)||(i.rs.forEach(function(i){var e="/do?filename="+i,t=window.open(e,"_blank");t&&t.print(),noty({text:"File ["+i+"] has been downloaded",type:"success",timeout:4e3})}),primus.emit("listinvoices",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}}))}),primus.on("printorders",function(i){i.pdata;_.isUndefined(i.rs)||_.isNull(i.rs)||i.rs.forEach(function(i){var e="/do?filename="+i,t=window.open(e,"_blank");t&&t.print()})}),primus.on("printdeliverydockets",function(i){i.pdata;_.isUndefined(i.rs)||_.isNull(i.rs)||i.rs.forEach(function(i){var e="/do?filename="+i,t=window.open(e,"_blank");t&&t.print()})}),primus.on("printquotes",function(i){i.pdata;_.isUndefined(i.rs)||_.isNull(i.rs)||i.rs.forEach(function(i){var e="/do?filename="+i,t=window.open(e,"_blank");t&&t.print()})}),primus.on("emailorder",function(i){var e=i.pdata||"";if(!_.isUndefined(e.callback)&&!_.isNull(e.callback)){var t=window[e.callback];_.isFunction(t)&&t(e)}primus.emit("emailhistory",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("searchinvoices",function(i){var e=i.pdata||"";_.isUndefined(i.rs)||_.isNull(i.rs)||(cache_invoices=[],i.rs.forEach(function(i){cache_invoices.push({id:doNiceId(i.id),clientname:doNiceString(i.clientname),name:doNiceString(i.name),pono:doNiceString(i.pono),invoiceno:doNiceString(i.invoiceno),orderno:doNiceString(i.orderno),totalprice:_.formatnumber(i.totalprice,4),copyno:i.copyno,date:doNiceDate(i.invoicedate),by:doNiceTitleizeString(i.userinvoiced)})}),refreshFromCacheInvoices(e))}),primus.on("loadconfig",function(i){i.pdata;doUpdateInitTasksProgress(),_.isUndefined(i.config)||_.isNull(i.config)||(cache_config={statusid:i.config.statusid,inventoryadjustaccountid:i.config.inventoryadjustaccountid,currentorderno:i.config.currentorderno,currentinvoiceno:i.config.currentinvoiceno,currentjournalno:i.config.currentjournalno,orderasquote:doNiceIntToBool(i.config.orderasquote),inventoryusefifo:doNiceIntToBool(i.config.inventoryusefifo),defaultinventorylocationid:i.config.defaultinventorylocationid,invoiceprinttemplateid:i.config.invoiceprinttemplateid,orderprinttemplateid:i.config.orderprinttemplateid,quoteprinttemplateid:i.config.quoteprinttemplateid,deliverydocketprinttemplateid:i.config.deliverydocketprinttemplateid,date:doNiceDateModifiedOrCreated(i.config.datemodified,i.config.datecreated),by:doNiceModifiedBy(i.config.datemodified,i.config.usermodified,i.config.usercreated)})}),primus.on("saveconfig",function(i){i.pdata}),primus.on("listproductcategories",function(i){i.pdata;doUpdateInitTasksProgress(),_.isUndefined(i.rs)||_.isNull(i.rs)||(cache_productcategories=[],i.rs.forEach(function(i){cache_productcategories.push({id:doNiceId(i.id),parentid:doNiceId(i.parentid),parentname:doNiceId(i.parentname),code:doNiceString(i.code),name:doNiceString(i.name),date:doNiceDateModifiedOrCreated(i.datemodified,i.datecreated),by:doNiceModifiedBy(i.datemodified,i.usermodified,i.usercreated)})}))}),primus.on("newproductcategory",function(i){i.pdata;primus.emit("listproductcategories",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh",productcategoryid:i.productcategoryid}})}),primus.on("saveproductcategory",function(i){i.pdata;primus.emit("listproductcategories",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh",productcategoryid:i.productcategoryid}})}),primus.on("changeproductcategoryparent",function(i){i.pdata;primus.emit("listproductcategories",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh",productcategoryid:i.productcategoryid}})}),primus.on("expireproductcategory",function(i){i.pdata;primus.emit("listproductcategories",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("listproducts",function(i){i.pdata;doUpdateInitTasksProgress(),_.isUndefined(i.rs)||_.isNull(i.rs)||(cache_products=[],i.rs.forEach(function(i){i.clientid==theclientid&&cache_products.push({id:doNiceId(i.id),productcategoryid:doNiceId(i.productcategoryid),productcategoryname:doNiceString(i.productcategoryname),name:doNiceString(i.name),code:doNiceString(i.code),barcode:doNiceString(i.altcode),costprice:_.formatnumber(i.costprice,4),costgst:_.formatnumber(i.costgst,4),taxcodeid:doNiceId(i.taxcodeid),salesaccountid:doNiceId(i.salesaccountid),incomeaccountid:doNiceId(i.incomeaccountid),assetaccountid:doNiceId(i.assetaccountid),uom:doNiceString(i.uom).toUpperCase(),uomsize:_.formatnumber(i.uomsize,4),minstock:_.formatnumber(i.minstockqty,4),stockwarn:_.formatnumber(i.stockqtywarnthreshold,4),width:_.formatnumber(i.width,4),length:_.formatnumber(i.length,4),height:_.formatnumber(i.height,4),weight:_.formatnumber(i.weight,4),attrib1:doNiceString(i.attrib1),attrib2:doNiceString(i.attrib2),attrib3:doNiceString(i.attrib3),attrib4:doNiceString(i.attrib4),attrib5:doNiceString(i.attrib5),isactive:i.isactive,date:doNiceDateModifiedOrCreated(i.datemodified,i.datecreated),by:doNiceModifiedBy(i.datemodified,i.usermodified,i.usercreated)})}))}),primus.on("listproductsbycategory",function(i){var e=i.pdata||"";_.isUndefined(i.rs)||_.isNull(i.rs)||(cache_productsbycategory=[],i.rs.forEach(function(i){cache_productsbycategory.push({id:doNiceId(i.id),productcategoryid:doNiceId(i.productcategoryid),name:doNiceString(i.name),code:doNiceString(i.code),barcode:doNiceString(i.altcode),costprice:_.formatnumber(i.costprice,4),costgst:_.formatnumber(i.costgst,4),taxcodeid:doNiceId(i.taxcodeid),salesaccountid:doNiceId(i.salesaccountid),incomeaccountid:doNiceId(i.incomeaccountid),assetaccountid:doNiceId(i.assetaccountid),uom:doNiceString(i.uom).toUpperCase(),uomsize:_.formatnumber(i.uomsize,4),minstock:_.formatnumber(i.minstockqty,4),stockwarn:_.formatnumber(i.stockqtywarnthreshold,4),width:_.formatnumber(i.width,4),length:_.formatnumber(i.length,4),height:_.formatnumber(i.height,4),weight:_.formatnumber(i.weight,4),attrib1:doNiceString(i.attrib1),attrib2:doNiceString(i.attrib2),attrib3:doNiceString(i.attrib3),attrib4:doNiceString(i.attrib4),attrib5:doNiceString(i.attrib5),inventoryqty:_.formatnumber(i.inventoryqty,4),orderqty:_.formatnumber(i.orderqty,4),isactive:i.isactive,date:doNiceDateModifiedOrCreated(i.datemodified,i.datecreated),by:doNiceModifiedBy(i.datemodified,i.usermodified,i.usercreated)})}),refreshFromCacheProductsByCategory(e))}),primus.on("newproduct",function(i){i.pdata;primus.emit("listproductsbycategory",{fguid:fguid,uuid:uuid,session:session,productcategoryid:i.productcategoryid,pdata:{type:"refresh",productid:i.productid}}),primus.emit("listproducts",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("saveproduct",function(i){i.pdata;primus.emit("listproductsbycategory",{fguid:fguid,uuid:uuid,session:session,productcategoryid:i.productcategoryid,pdata:{type:"refresh",productid:i.productid}}),primus.emit("listproducts",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("changeproductparent",function(i){i.pdata;primus.emit("listproducts",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("expireproduct",function(i){i.pdata;primus.emit("listproductsbycategory",{fguid:fguid,uuid:uuid,session:session,productcategoryid:i.productcategoryid,pdata:{type:"refresh"}}),primus.emit("listproducts",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("duplicateproduct",function(i){i.pdata;primus.emit("listproductsbycategory",{fguid:fguid,uuid:uuid,session:session,productcategoryid:i.productcategoryid,pdata:{type:"refresh"}}),primus.emit("listproducts",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("checkproductcode",function(i){var e=i.pdata||"";if(!(_.isUndefined(i.rs)||_.isNull(i.rs)||_.isUndefined(e.callback)||_.isNull(e.callback))){var t=window[e.callback];_.isFunction(t)&&t(i.rs)}}),primus.on("productsearch",function(i){var e=i.pdata||"";if(!(_.isUndefined(i.rs)||_.isNull(i.rs)||_.isUndefined(e.callback)||_.isNull(e.callback))){var t=window[e.callback];_.isFunction(t)&&t(i.rs)}}),primus.on("listproductpricing",function(i){var e=i.pdata||"";_.isUndefined(i.rs)||_.isNull(i.rs)||(cache_productprices=[],i.rs.forEach(function(i){cache_productprices.push({id:doNiceId(i.id),clientid:doNiceId(i.clientid),minqty:_.formatnumber(i.minqty,4),maxqty:_.formatnumber(i.maxqty,4),price:_.formatnumber(i.price,4),date:doNiceDateModifiedOrCreated(i.datemodified,i.datecreated),by:doNiceModifiedBy(i.datemodified,i.usermodified,i.usercreated)})}),refreshFromCacheProductPrices(e))}),primus.on("newproductpricing",function(i){i.pdata;primus.emit("listproductpricing",{fguid:fguid,uuid:uuid,session:session,productid:i.productid,pdata:{type:"refresh",priceid:i.priceid}})}),primus.on("saveproductpricing",function(i){i.pdata;primus.emit("listproductpricing",{fguid:fguid,uuid:uuid,session:session,productid:i.productid,pdata:{type:"refresh",priceid:i.priceid}})}),primus.on("expireproductpricing",function(i){i.pdata;primus.emit("listproductpricing",{fguid:fguid,uuid:uuid,session:session,productid:i.productid,pdata:{type:"refresh"}})}),primus.on("getproductprices",function(i){var e=i.pdata||"";_.isUndefined(i.rs)||_.isNull(i.rs)||(cache_productpriceselection=[],i.rs.forEach(function(i){cache_productpriceselection.push({id:doNiceId(i.id),clientid:i.clientid,price:_.formatnumber(i.price,4),minqty:_.formatnumber(i.minqty,4),maxqty:_.formatnumber(i.maxqty,4)})}),refreshFromCacheProductSelectPrice(e))}),primus.on("getprice",function(i){var e=i.pdata||"";if(!(_.isUndefined(i.price)||_.isNull(i.price)||_.isUndefined(e.callback)||_.isNull(e.callback))){var t=window[e.callback];_.isFunction(t)&&t(i.price,e.rowIndex)}}),primus.on("liststatusalerts",function(i){console.log(i);var e=i.pdata||"";doUpdateInitTasksProgress(),_.isUndefined(i.rs)||_.isNull(i.rs)||(cache_statusalerts=[],i.rs.forEach(function(i){cache_statusalerts.push({id:doNiceId(i.id),uuid:doNiceId(i.uuid),status:i.status,email:doNiceString(i.email),mobile:doNiceString(i.mobile),date:doNiceDateModifiedOrCreated(i.datemodified,i.datecreated),by:doNiceModifiedBy(i.datemodified,i.usermodified,i.usercreated)})}),refreshFromCacheStatusAlerts(e))}),primus.on("newstatusalert",function(i){console.log(i);i.pdata;primus.emit("liststatusalerts",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh",statusalertid:i.statusalertid}})}),primus.on("savestatusalert",function(i){i.pdata;primus.emit("liststatusalerts",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh",statusalertid:i.statusalertid}})}),primus.on("expirestatusalert",function(i){i.pdata;primus.emit("liststatusalerts",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("listorders",function(i){var e=i.pdata||"";doUpdateInitTasksProgress(),_.isUndefined(i.rs)||_.isNull(i.rs)||(cache_orders=[],i.rs.forEach(function(i){i.clientid==theclientid&&cache_orders.push({id:doNiceId(i.id),clientid:doNiceId(i.clientid),orderno:doNiceString(i.orderno),invoiceno:doNiceString(i.invoiceno),name:doNiceString(i.name),pono:doNiceString(i.pono),numversions:i.numversions,activeversion:i.activeversion,startdate:i.startdate,enddate:i.enddate,accountid:doNiceId(i.accountid),totalprice:_.sanitiseAsNumeric(i.totalprice,4),totalqty:_.sanitiseAsNumeric(i.totalqty,4),invoicetemplateid:doNiceId(i.invoicetemplateid),ordertemplateid:doNiceId(i.ordertemplateid),quotetemplateid:doNiceId(i.quotetemplateid),shiptoclientid:doNiceId(i.shiptoclientid),shiptoname:doNiceString(i.shiptoname),shiptoaddress1:doNiceString(i.shiptoaddress1),shiptoaddress2:doNiceString(i.shiptoaddress2),shiptocity:doNiceString(i.shiptocity),shiptostate:doNiceString(i.shiptostate),shiptopostcode:doNiceString(i.shiptopostcode),shiptocountry:doNiceString(i.shiptocountry),invoicetoclientid:doNiceId(i.invoicetoclientid),invoicetoname:doNiceString(i.invoicetoname),invoicetoaddress1:doNiceString(i.invoicetoaddress1),invoicetoaddress2:doNiceString(i.invoicetoaddress2),invoicetocity:doNiceString(i.invoicetocity),invoicetostate:doNiceString(i.invoicetostate),invoicetopostcode:doNiceString(i.invoicetopostcode),invoicetocountry:doNiceString(i.invoicetocountry),inventorycommitted:i.inventorycommitted,status:doGetStringFromIdInObjArray(orderstatustypes,i.status),majorstatus:doGetStringFromIdInObjArray(orderstatustypes,i.majorstatus),attachmentid:doNiceId(i.attachmentid),attachmentname:doNiceString(i.attachmentname),attachmentimage:doNiceString(i.attachmentimage),date:doNiceDateModifiedOrCreated(i.datemodified,i.datecreated),by:doNiceModifiedBy(i.datemodified,i.usermodified,i.usercreated)})}),refreshFromCacheOrders(e))}),primus.on("neworder",function(i){i.pdata;primus.emit("listorders",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh",orderid:i.orderid}})}),primus.on("saveorder",function(i){i.pdata;primus.emit("listorders",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh",orderid:i.orderid}})}),primus.on("expireorder",function(i){i.pdata;primus.emit("listorders",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("duplicateorder",function(i){i.pdata;primus.emit("listorders",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh",orderid:i.orderid}})}),primus.on("newversionorder",function(i){i.pdata;primus.emit("listorders",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh",orderid:i.orderid}})}),primus.on("createinvoicefromorder",function(i){i.pdata;doClearOrder()}),primus.on("searchorders",function(i){var e=i.pdata||"";_.isUndefined(i.rs)||_.isNull(i.rs)||(cache_orders=[],i.rs.forEach(function(i){console.log(i),cache_orders.push({id:doNiceId(i.id),clientid:doNiceId(i.clientid),orderno:doNiceString(i.orderno),invoiceno:doNiceString(i.invoiceno),name:doNiceString(i.name),pono:doNiceString(i.pono),numversions:i.numversions,activeversion:i.activeversion,startdate:i.startdate,enddate:i.enddate,accountid:doNiceId(i.accountid),totalprice:_.formatnumber(i.totalprice,4),totalqty:_.formatnumber(i.totalqty,4),invoicetemplateid:doNiceId(i.invoicetemplateid),shiptoclientid:doNiceId(i.shiptoclientid),shiptoname:doNiceString(i.shiptoname),shiptoaddress1:doNiceString(i.shiptoaddress1),shiptoaddress2:doNiceString(i.shiptoaddress2),shiptocity:doNiceString(i.shiptocity),shiptostate:doNiceString(i.shiptostate),shiptopostcode:doNiceString(i.shiptopostcode),shiptocountry:doNiceString(i.shiptocountry),invoicetoclientid:doNiceId(i.invoicetoclientid),invoicetoname:doNiceString(i.invoicetoname),invoicetoaddress1:doNiceString(i.invoicetoaddress1),invoicetoaddress2:doNiceString(i.invoicetoaddress2),invoicetocity:doNiceString(i.invoicetocity),invoicetostate:doNiceString(i.invoicetostate),invoicetopostcode:doNiceString(i.invoicetopostcode),invoicetocountry:doNiceString(i.invoicetocountry),status:doGetStringFromIdInObjArray(orderstatustypes,i.status),majorstatus:doGetStringFromIdInObjArray(orderstatustypes,i.majorstatus),date:doNiceDateModifiedOrCreated(i.datemodified,i.datecreated),by:doNiceModifiedBy(i.datemodified,i.usermodified,i.usercreated)})}),refreshFromCacheOrders(e))}),primus.on("listorderattachments",function(i){var e=i.pdata||"";_.isUndefined(i.rs)||_.isNull(i.rs)||(cache_orderattachments=[],i.rs.forEach(function(i){cache_orderattachments.push({id:doNiceId(i.id),name:doNiceString(i.name),description:doNiceString(i.description),mimetype:'<a href="javascript:void(0);" onClick="doThrowOrderAttachment('+i.id+');">'+mapMimeTypeToImage(i.mimetype)+"</a>",size:doNiceString(i.size),isthumbnail:i.isthumbnail,image:doNiceString(i.image),date:doNiceDateModifiedOrCreated(i.datemodified,i.datecreated),by:doNiceModifiedBy(i.datemodified,i.usermodified,i.usercreated)})}),refreshFromCacheOrderAttachments(e))}),primus.on("saveorderattachment",function(i){i.pdata;primus.emit("listorderattachments",{fguid:fguid,uuid:uuid,session:session,orderid:i.orderid,pdata:{type:"refresh"}})}),primus.on("expireorderattachment",function(i){i.pdata;primus.emit("listorderattachments",{fguid:fguid,uuid:uuid,session:session,orderid:i.orderid,pdata:{type:"refresh"}})}),primus.on("listordernotes",function(i){var e=i.pdata||"";_.isUndefined(i.rs)||_.isNull(i.rs)||(cache_ordernotes=[],i.rs.forEach(function(i){cache_ordernotes.push({id:doNiceId(i.id),notes:doNiceString(i.notes),date:doNiceDateModifiedOrCreated(i.datemodified,i.datecreated),by:doNiceModifiedBy(i.datemodified,i.usermodified,i.usercreated)})}),refreshFromCacheOrderNotes(e))}),primus.on("newordernote",function(i){i.pdata;primus.emit("listordernotes",{fguid:fguid,uuid:uuid,session:session,orderid:i.orderid,pdata:{type:"refresh",ordernoteid:i.ordernoteid}})}),primus.on("saveordernote",function(i){i.pdata;primus.emit("listordernotes",{fguid:fguid,uuid:uuid,session:session,orderid:i.orderid,pdata:{type:"refresh",ordernoteid:i.ordernoteid}})}),primus.on("listorderstatuses",function(i){var e=i.pdata||"";_.isUndefined(i.rs)||_.isNull(i.rs)||(cache_orderstatuses=[],i.rs.forEach(function(i){cache_orderstatuses.push({id:doNiceId(i.id),status:i.status,carriername:doNiceString(i.carriername),connote:doNiceString(i.connote),date:doNiceDateModifiedOrCreated(i.datemodified,i.datecreated),by:doNiceModifiedBy(i.datemodified,i.usermodified,i.usercreated)})}),refreshFromCacheOrderStatuses(e))}),primus.on("neworderstatus",function(i){i.pdata;primus.emit("listorderstatuses",{fguid:fguid,uuid:uuid,session:session,orderid:i.orderid,pdata:{type:"refresh",orderstatusid:i.orderstatusid}})}),primus.on("listorderdetails",function(i){var e=i.pdata||"";_.isUndefined(i.rs)||_.isNull(i.rs)||(cache_orderproducts=[],i.rs.forEach(function(i){cache_orderproducts.push({id:doNiceId(i.id),productid:doNiceId(i.productid),name:doNiceString(i.productname),price:doNiceString(i.price),qty:doNiceString(i.qty),date:doNiceDateModifiedOrCreated(i.datemodified,i.datecreated),by:doNiceModifiedBy(i.datemodified,i.usermodified,i.usercreated)})}),refreshFromCacheOrderDetails(e))}),primus.on("neworderdetail",function(i){i.pdata;primus.emit("listorderdetails",{fguid:fguid,uuid:uuid,session:session,orderid:i.orderid,version:i.version,pdata:{type:"refresh",orderdetailid:i.orderdetailid}})}),primus.on("saveorderdetail",function(i){i.pdata;primus.emit("listorderdetails",{fguid:fguid,uuid:uuid,session:session,orderid:i.orderid,version:i.version,pdata:{type:"refresh",orderdetailid:i.orderdetailid}})}),primus.on("expireorderdetail",function(i){i.pdata;primus.emit("listorderdetails",{fguid:fguid,uuid:uuid,session:session,orderid:i.orderid,version:i.version,pdata:{type:"refresh",orderdetailid:i.orderdetailid}})}),primus.on("emailhistory",function(i){var e=i.pdata||"";_.isUndefined(i.rs)||_.isNull(i.rs)||(doUpdateInitTasksProgress(),cache_emails=[],i.rs.forEach(function(i){cache_emails.push({id:doNiceId(i.id),copyno:i.copyno,orderno:doNiceString(i.orderno),recipients:doNiceString(i.recipients),subject:doNiceString(i.subject),orderid:doNiceId(i.orderid),datesent:doNiceDate(i.datesent),datecreated:doNiceDate(i.datecreated),by:doNiceTitleizeString(i.usercreated)})}),refreshFromCacheEmails(e))}),primus.on("report",function(i){}),primus.on("eventerror",function(i){i.pdata;if(!(_.isUndefined(i.rc)||_.isNull(i.rc)||_.isUndefined(i.msg)||_.isNull(i.msg)))switch(i.rc){case errcode_nodata:noty({text:"No data or no matching data",type:"information",timeout:4e3});break;case errcode_usernotregistered:case errcode_invalidlogin:noty({text:"Login failed, please try again",type:"error",timeout:4e3,force:!0,killer:!0}),$("#fldUid").focus();break;default:noty({text:"Error "+i.rc+": "+i.msg,type:"error",timeout:1e4})}}),primus.on("accountcreated",function(i){primus.emit("listaccounts",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("accountsaved",function(i){primus.emit("listaccounts",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("accountparentchanged",function(i){primus.emit("listaccounts",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("accountexpired",function(i){primus.emit("listaccounts",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("journalcreated",function(i){primus.emit("listjournals",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("productcategorycreated",function(i){primus.emit("listproductcategories",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("productcategorysaved",function(i){primus.emit("listproductcategories",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("productcategoryparentchanged",function(i){primus.emit("listproductcategories",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("productcategoryexpired",function(i){primus.emit("listproductcategories",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("superfundcreated",function(i){primus.emit("listsuperfunds",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("superfundsaved",function(i){primus.emit("listsuperfunds",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("superfundexpired",function(i){primus.emit("listsuperfunds",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("exchangeratecreated",function(i){primus.emit("listexchangerates",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("exchangeratesaved",function(i){primus.emit("listexchangerates",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("exchangerateexpired",function(i){primus.emit("listexchangerates",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("taxcodecreated",function(i){primus.emit("listtaxcodes",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("taxcodesaved",function(i){primus.emit("listtaxcodes",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("taxcodeexpired",function(i){primus.emit("listtaxcodes",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("locationcreated",function(i){primus.emit("listlocations",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("locationsaved",function(i){primus.emit("listlocations",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("locationparentchanged",function(i){primus.emit("listlocations",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("locationexpired",function(i){primus.emit("listlocations",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("clientcreated",function(i){primus.emit("listclients",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("clientsaved",function(i){primus.emit("listclients",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}}),primus.emit("listsuppliers",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("clientparentchanged",function(i){primus.emit("listclients",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("clientexpired",function(i){primus.emit("listclients",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("clientnotecreated",function(i){primus.emit("listclientnotes",{fguid:fguid,uuid:uuid,session:session,clientid:i.clientid,pdata:{type:"refresh"}})}),primus.on("clientnotesaved",function(i){primus.emit("listclientnotes",{fguid:fguid,uuid:uuid,session:session,clientid:i.clientid,pdata:{type:"refresh"}})}),primus.on("clientattachmentcreated",function(i){primus.emit("listclientattachments",{fguid:fguid,uuid:uuid,session:session,clientid:i.clientid,pdata:{type:"refresh"}})}),primus.on("clientattachmentsaved",function(i){primus.emit("listclientattachments",{fguid:fguid,uuid:uuid,session:session,clientid:i.clientid,pdata:{type:"refresh"}})}),primus.on("clientattachmentexpired",function(i){primus.emit("listclientattachments",{fguid:fguid,uuid:uuid,session:session,clientid:i.clientid,pdata:{type:"refresh"}})}),primus.on("suppliercreated",function(i){primus.emit("listsuppliers",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("suppliersaved",function(i){primus.emit("listclients",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}}),primus.emit("listsuppliers",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("supplierparentchanged",function(i){primus.emit("listsuppliers",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("supplierexpired",function(i){primus.emit("listsuppliers",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("suppliernotecreated",function(i){primus.emit("listsuppliernotes",{fguid:fguid,uuid:uuid,session:session,clientid:i.clientid,pdata:{type:"refresh"}})}),primus.on("suppliernotesaved",function(i){primus.emit("listsuppliernotes",{fguid:fguid,uuid:uuid,session:session,clientid:i.clientid,pdata:{type:"refresh"}})}),primus.on("supplierattachmentcreated",function(i){primus.emit("listsupplierattachments",{fguid:fguid,uuid:uuid,session:session,clientid:i.clientid,pdata:{type:"refresh"}})}),primus.on("supplierattachmentsaved",function(i){primus.emit("listsupplierattachments",{fguid:fguid,uuid:uuid,session:session,clientid:i.clientid,pdata:{type:"refresh"}})}),primus.on("supplierattachmentexpired",function(i){primus.emit("listsupplierattachments",{fguid:fguid,uuid:uuid,session:session,clientid:i.clientid,pdata:{type:"refresh"}})}),primus.on("employeecreated",function(i){primus.emit("listemployees",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("employeesaved",function(i){primus.emit("listemployees",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("employeeexpired",function(i){primus.emit("listemployees",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("employeeparentchanged",function(i){primus.emit("listemployees",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("productcreated",function(i){$("#cbProductsCategories").combobox("getValue")==i.productcategoryid&&primus.emit("listproductsbycategory",{fguid:fguid,uuid:uuid,session:session,productcategoryid:i.productcategoryid,pdata:{type:"refresh"}}),primus.emit("listproducts",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("productsaved",function(i){primus.emit("listproducts",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("productparentchanged",function(i){$("#cbProductsCategories").combobox("getValue")==i.productcategoryid&&primus.emit("listproductsbycategory",{fguid:fguid,uuid:uuid,session:session,productcategoryid:i.productcategoryid,pdata:{type:"refresh"}}),primus.emit("listproducts",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("productexpired",function(i){$("#cbProductsCategories").combobox("getValue")==i.productcategoryid&&primus.emit("listproductsbycategory",{fguid:fguid,uuid:uuid,session:session,productcategoryid:i.productcategoryid,pdata:{type:"refresh"}}),primus.emit("listproducts",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("productpricingcreated",function(i){viewingProductId==i.productid&&primus.emit("listproductpricing",{fguid:fguid,uuid:uuid,session:session,productid:i.productid,pdata:{type:"refresh"}})}),primus.on("productpricingsaved",function(i){viewingProductId==i.productid&&primus.emit("listproductpricing",{fguid:fguid,uuid:uuid,session:session,productid:i.productid,pdata:{type:"refresh"}})}),primus.on("productpricingexpired",function(i){primus.emit("listproductpricing",{fguid:fguid,uuid:uuid,session:session,productid:i.productid,pdata:{type:"refresh"}})}),primus.on("producttemplatecreated",function(i){primus.emit("listproducttemplates",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("producttemplatesaved",function(i){primus.emit("listproducttemplates",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("producttemplateparentchanged",function(i){primus.emit("listproducttemplates",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("producttemplateexpired",function(i){primus.emit("listproducttemplates",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("producttemplateduplicated",function(i){primus.emit("listproducttemplates",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("producttemplatebuilt",function(i){primus.emit("liststock",{fguid:fguid,uuid:uuid,session:session,pdata:"refresh-all"})}),primus.on("producttemplatedetailcreated",function(i){primus.emit("listproductsbytemplate",{fguid:fguid,uuid:uuid,session:session,producttemplateid:i.producttemplateid,pdata:{type:"refresh"}})}),primus.on("producttemplatedetailsaved",function(i){primus.emit("listproductsbytemplate",{fguid:fguid,uuid:uuid,session:session,producttemplateid:i.producttemplateid,pdata:{type:"refresh"}})}),primus.on("producttemplatedetailexpired",function(i){primus.emit("listproductsbytemplate",{fguid:fguid,uuid:uuid,session:session,producttemplateid:i.producttemplateid,pdata:{type:"refresh"}})}),primus.on("invoicecreated",function(i){_.isUndefined(i.orderid)||_.isNull(i.orderid)||(primus.emit("listorders",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}}),primus.emit("listinvoices",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}}))}),primus.on("ordercreated",function(i){primus.emit("listorders",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("ordersaved",function(i){primus.emit("listorders",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("orderexpired",function(i){primus.emit("listorders",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("orderduplicated",function(i){primus.emit("listorders",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("ordernewversion",function(i){primus.emit("listorders",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("orderinvoicetosaved",function(i){}),primus.on("orderstatuscreated",function(i){primus.emit("listorderstatuses",{fguid:fguid,uuid:uuid,session:session,orderid:i.orderid,pdata:{type:"refresh"}}),primus.emit("listorders",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("orderstatusalert",function(i){_.isUndefined(i.orderid)||_.isNull(i.orderid)||doStatusAlert(i)}),primus.on("ordernotecreated",function(i){primus.emit("listordernotes",{fguid:fguid,uuid:uuid,session:session,orderid:i.orderid,pdata:{type:"refresh"}})}),primus.on("ordernotesaved",function(i){primus.emit("listordernotes",{fguid:fguid,uuid:uuid,session:session,orderid:i.orderid,pdata:{type:"refresh"}})}),primus.on("orderattachmentcreated",function(i){primus.emit("listorderattachments",{fguid:fguid,uuid:uuid,session:session,orderid:i.orderid,pdata:{type:"refresh"}})}),primus.on("orderattachmentsaved",function(i){primus.emit("listorderattachments",{fguid:fguid,uuid:uuid,session:session,orderid:i.orderid,pdata:{type:"refresh"}})}),primus.on("orderattachmentexpired",function(i){primus.emit("listorderattachments",{fguid:fguid,uuid:uuid,session:session,orderid:i.orderid,pdata:{type:"refresh"}})}),primus.on("orderdetailcreated",function(i){primus.emit("listorderdetails",{fguid:fguid,uuid:uuid,session:session,orderid:i.orderid,version:i.version,pdata:{type:"refresh",orderdetailid:i.orderdetailid,orderid:i.orderid,version:i.version}})}),primus.on("orderdetailsaved",function(i){primus.emit("listorderdetails",{fguid:fguid,uuid:uuid,session:session,orderid:i.orderid,version:i.version,pdata:{type:"refresh",orderdetailid:i.orderdetailid,orderid:i.orderid,version:i.version}})}),primus.on("orderdetailexpired",function(i){primus.emit("listorderdetails",{fguid:fguid,uuid:uuid,session:session,orderid:i.orderid,version:i.version,pdata:{type:"refresh"}})}),primus.on("inventoryadded",function(i){primus.emit("liststock",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("inventorybuilt",function(i){primus.emit("liststock",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("buildexpired",function(i){primus.emit("listbuilds",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}}),primus.emit("liststock",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("statusalertcreated",function(i){primus.emit("liststatusalerts",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("statusalertsaved",function(i){primus.emit("liststatusalerts",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("clientsimported",function(i){noty({text:"Imported clients file: "+i.filename+", #Inserted: "+i.numinserted+", #Updated: "+i.numupdated+", #Skipped: "+i.numskipped,type:"success",timeout:1e4}),primus.emit("listclients",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("productsimported",function(i){noty({text:"Imported products file: "+i.filename+", #Inserted: "+i.numinserted+", #Updated: "+i.numupdated+", #Skipped: "+i.numskipped,type:"success",timeout:1e4}),primus.emit("listproducts",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("newrtap",function(i){$("#divEvents").trigger("newrtap",{data:i,pdata:"none"})}),primus.on("emailsent",function(i){primus.emit("emailhistory",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("usercreated",function(i){_.isUndefined(i.uuid)||_.isNull(i.uuid)||primus.emit("listusers",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("usersaved",function(i){_.isUndefined(i.uuid)||_.isNull(i.uuid)||primus.emit("listusers",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("userpermissionssaved",function(i){_.isUndefined(i.uuid)||_.isNull(i.uuid)||primus.emit("listusers",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("configsaved",function(i){primus.emit("loadconfig",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("printtemplatecreated",function(i){primus.emit("listprinttemplates",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("printtemplatesaved",function(i){primus.emit("listprinttemplates",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("printtemplateexpired",function(i){primus.emit("listprinttemplates",{fguid:fguid,uuid:uuid,session:session,pdata:{type:"refresh"}})}),primus.on("newchatmsg",function(i){doAddNewChatMsg(i)}),primus.on("useronline",function(i){}),primus.on("useroffline",function(i){}),primus.on("userlogout",function(i){})}catch(i){console.log("****************** Primus exception: "+i)}}