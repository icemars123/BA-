var selectedSupplierIdAttachmentId=null;function doDlgSupplierAttachments(i){var n=null,e=[{text:"Clear",iconCls:"icon-clear",handler:function(){$("#divSupplierAttachmentsG").datagrid("clearSelections")}},{text:"Edit",iconCls:"icon-edit",handler:d},{text:"Cancel",iconCls:"icon-cancel",handler:function(){n=doGridCancelEdit("divSupplierAttachmentsG",n)}},{text:"Save",iconCls:"icon-save",handler:function(){doGridEndEditGetRow("divSupplierAttachmentsG",n,function(e){doServerDataMessage("savesupplierattachment",{supplierattachmentid:e.id,description:e.description},{type:"refresh"})}),n=null}},{text:"Remove",iconCls:"icon-remove",handler:a},{text:"Download",iconCls:"icon-download",handler:r}];function d(){doGridStartEdit("divSupplierAttachmentsG",n,function(e,t){n=t,doGridGetEditor("divSupplierAttachmentsG",n,"description",function(e){})})}function a(){doGridGetSelectedRowData("divSupplierAttachmentsG",function(t){doPromptOkCancel("Remove attachment "+t.description+"?",function(e){e&&doServerDataMessage("expiresupplierattachment",{supplierattachmentid:t.id},{type:"refresh"})})})||doShowError("Please select an attachment to remove")}function r(){doGridGetSelectedRowData("divSupplierAttachmentsG",function(e){doThrowClientAttachment(e.id)})}function t(e,t){i.id==t.data.supplierid&&doServerDataMessage("listsupplierattachments",{supplierid:i.id},{type:"refresh"})}function o(e,t){var i=[];t.data.rs.forEach(function(e){i.push({id:doNiceId(e.id),name:doNiceString(e.name),description:doNiceString(e.description),mimetype:'<a href="javascript:void(0);" onClick="doThrowSupplierAttachment('+e.id+');">'+mapMimeTypeToImage(e.mimetype)+"</a>",size:doNiceString(e.size),image:'<image src="'+e.image+'" width="35px">',date:doNiceDateModifiedOrCreated(e.datemodified,e.datecreated),by:doNiceModifiedBy(e.datemodified,e.usermodified,e.usercreated)})}),$("#divSupplierAttachmentsG").datagrid("loadData",i)}function l(e,t){"edit"==t?d():"remove"==t?a():"download"==t&&r()}$("#divEvents").on("savesupplierattachment",t),$("#divEvents").on("expiresupplierattachment",t),$("#divEvents").on("supplierattachmentcreated",t),$("#divEvents").on("supplierattachmentsaved",t),$("#divEvents").on("supplierattachmentexpired",t),$("#divEvents").on("listsupplierattachments",o),$("#divEvents").on("supplierattachmentspopup",l),$("#dlgSupplierAttachments").dialog({title:"Attachments for "+i.name,onClose:function(){$("#divEvents").off("savesupplierattachment",t),$("#divEvents").off("expiresupplierattachment",t),$("#divEvents").off("supplierattachmentcreated",t),$("#divEvents").off("supplierattachmentsaved",t),$("#divEvents").off("supplierattachmentexpired",t),$("#divEvents").off("listsupplierattachments",o),$("#divEvents").off("supplierattachmentspopup",l)},onOpen:function(){selectedSupplierIdAttachmentId=i.id,$("#divSupplierAttachmentsG").datagrid({idField:"id",fitColumns:!0,singleSelect:!0,rownumbers:!1,striped:!0,toolbar:e,columns:[[{title:"Name",field:"name",width:200,align:"left",resizable:!0},{title:"Description",field:"description",width:300,align:"left",resizable:!0,editor:"text"},{title:"Type",field:"mimetype",width:100,align:"center",resizable:!0},{title:"Size",field:"size",width:150,align:"right",resizable:!0,formatter:function(e,t){return filesize(e,{base:10})}},{title:"Modified",field:"date",width:150,align:"right",resizable:!0},{title:"By",field:"by",width:200,align:"left",resizable:!0}]],onRowContextMenu:function(e,t,i){doGridContextMenu("divSupplierAttachmentsG","divSupplierAttachmentsMenuPopup",e,t,i)},onDblClickCell:function(e,t,i){doGridStartEdit("divSupplierAttachmentsG",n,function(e,t){n=t,doGridGetEditor("divSupplierAttachmentsG",n,"description",function(e){})})}}),doServerDataMessage("listsupplierattachments",{supplierid:i.id},{type:"refresh"})},buttons:[{text:"Close",handler:function(){$("#dlgSupplierAttachments").dialog("close")}}]}).dialog("center").dialog("open")}