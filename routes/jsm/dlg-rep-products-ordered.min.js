function doDlgRepProductsOrdered(){var t=[];function e(e,t){var r=_.toBigNum(0);$("#divRepProductsOrderedG").datagrid("loadData",t.data.rs),t.data.rs.forEach(function(e){r+=_.toBigNum(e.qty)}),$("#divRepProductsOrderedG").datagrid("reloadFooter",[{qty:'<span class="totals_footer">'+_.niceformatnumber(r,2)+"</span>"}])}function r(){var e=$("#dtRepProductsOrderedDateFrom").datebox("getValue"),t=$("#dtRepProductsOrderedDateTo").datebox("getValue"),r=$("#cbRepProductsOrderedClients").combotree("getValues"),o=$("#cbRepProductsOrderedCategories").combotree("getValues"),d=$("#cbRepProductsOrderedCountry").combobox("getValue"),a=$("#cbRepProductsOrderedStates").combobox("getValue"),c=moment();if(_.isBlank(e)&&_.isBlank(t))doMandatoryTextbox("Please select a start and end date for the report","dtRepProductsOrderedDateFrom");else{if(_.isBlank(t)){if(moment(e).isAfter(c))return void doMandatoryTextbox("Start date can not be after today...","dtRepProductsOrderedDateFrom");t=c.format("YYYY-MM-DD hh:mm:ss")}if(_.isBlank(e)){if(moment(t).isBefore(c))return void doMandatoryTextbox("End date can not be before today...","dtRepProductsOrderedDateTo");e=c.format("YYYY-MM-DD hh:mm:ss")}doServerDataMessage("report",{report:"productsordered",datefrom:e,dateto:t,clients:r,categories:o,country:d,state:a},{type:"refresh"})}}$("#divEvents").on("report-productsordered",e),$("#divEvents").on("ordercreated",r),$("#divEvents").on("ordersaved",r),$("#divEvents").on("orderexpired",r),$("#divEvents").on("orderduplicated",r),$("#divEvents").on("ordernewversion",r),$("#dlgRepProductsOrdered").dialog({onClose:function(){$("#divEvents").off("report-productsordered",e),$("#divEvents").off("ordercreated",r),$("#divEvents").off("ordersaved",r),$("#divEvents").off("orderexpired",r),$("#divEvents").off("orderduplicated",r),$("#divEvents").off("ordernewversion",r)},onOpen:function(){$("#dtRepProductsOrderedDateFrom").datebox(),$("#dtRepProductsOrderedDateTo").datebox(),$("#cbRepProductsOrderedClients").combotree({valueField:"id",textField:"name",multiple:!0,data:cache_clients,limitToList:!0,onSelect:function(e){}}),$("#cbRepProductsOrderedCategories").combotree({valueField:"id",textField:"name",multiple:!0,data:cache_productcategories,limitToList:!0,onSelect:function(e){}}),$("#cbRepProductsOrderedCountry").combobox({valueField:"country",textField:"country",data:cache_countries,onSelect:function(e){t=doGetStatesFromCountry(e.country),$("#cbRepProductsOrderedStates").combobox("loadData",t)}}),$("#cbRepProductsOrderedStates").combobox({valueField:"state",textField:"state",data:t}),$("#divRepProductsOrderedG").datagrid({fitColumns:!1,singleSelect:!0,rownumbers:!0,striped:!0,showFooter:!0,sortName:"clientname",sortOrder:"asc",remoteSort:!1,multiSort:!0,columns:[[{title:"Client",field:"clientname",width:250,align:"left",resizable:!0,sortable:!0},{title:"Category",field:"productcategoryname",width:250,align:"left",resizable:!0,sortable:!0},{title:"Code",field:"productcode",width:250,align:"left",resizable:!0,sortable:!0,styler:function(e,t,r){if(!t.used)return"color: "+colour_deeppink}},{title:"Qty",field:"qty",width:100,align:"right",resizable:!0,sortable:!0,formatter:function(e,t){return _.isUndefined(t.productcode)?e:_.niceformatnumber(e,2)}}]]}),doTextboxFocus("dtRepTopXXProductsByValueDateFrom")},buttons:[{text:"Run",handler:function(){r()}},{text:"Reset",handler:function(){$("#dtRepProductsOrderedDateFrom").datebox("clear"),$("#dtRepProductsOrderedDateTo").datebox("clear"),$("#cbRepProductsOrderedClients").combotree("clear"),$("#cbRepProductsOrderedCategories").combotree("clear"),$("#cbRepProductsOrderedCountry").combobox("clear"),$("#cbRepProductsOrderedStates").combobox("clear")}},{text:"Close",handler:function(){$("#dlgRepProductsOrdered").dialog("close")}}]}).dialog("center").dialog("open")}