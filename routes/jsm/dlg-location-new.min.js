function doDlgLocationNew(e,r){var u=_.isUndefined(r)||_.isNull(r),t={},o=[];function a(){$("#cbNewLocationParent").combotree("clear"),u?($("#fldNewLocationName").textbox("clear"),$("#fldNewLocationCode").textbox("clear"),$("#fldNewLocationBay").textbox("clear"),$("#fldNewLocationLevel").textbox("clear"),$("#fldNewLocationShelf").textbox("clear"),$("#fldNewLocationAddress1").textbox("clear"),$("#fldNewLocationAddress2").textbox("clear"),$("#fldNewLocationCity").textbox("clear"),$("#fldNewLocationPostcode").textbox("clear"),$("#cbNewLocationState").combobox("clear"),$("#btnLocationNewAdd").linkbutton("disable"),$("#cbNewLocationParent").combotree("setValue",e),$("#cbNewLocationCountry").combobox("setValue",defaultCountry)):_.isEmpty(t)||($("#fldNewLocationName").textbox("setValue",t.name),$("#fldNewLocationCode").textbox("setValue",t.code),$("#fldNewLocationBay").textbox("setValue",t.bay),$("#fldNewLocationLevel").textbox("setValue",t.level),$("#fldNewLocationShelf").textbox("setValue",t.shelf),$("#fldNewLocationAddress1").textbox("setValue",t.address1),$("#fldNewLocationAddress2").textbox("setValue",t.address2),$("#fldNewLocationCity").textbox("setValue",t.city),$("#fldNewLocationPostcode").textbox("setValue",t.postcode),$("#cbNewLocationCountry").combobox("setValue",t.country),$("#cbNewLocationParent").combotree("setValue",t.parentid),$("#cbNewLocationState").combobox("setValue",t.state),$("#btnLocationNewAdd").linkbutton("enable"),$("#dlgLocationNew").dialog("setTitle","Modify "+t.name)),doTextboxFocus("fldNewLocationName")}function n(e,o){0<o.data.rs.length?$("#btnLocationNewAdd").linkbutton("disable"):$("#btnLocationNewAdd").linkbutton("enable")}function c(e,o){$("#dlgLocationNew").dialog("close")}function d(e,o){t=o.data.location,a()}$("#divEvents").on("checklocationcode",n),$("#divEvents").on("newlocation",c),$("#divEvents").on("savelocation",c),$("#divEvents").on("loadlocation",d),$("#dlgLocationNew").dialog({onClose:function(){$("#divEvents").off("checklocationcode",n),$("#divEvents").off("newlocation",c),$("#divEvents").on("savelocation",c),$("#divEvents").off("loadlocation",d)},onOpen:function(){$("#cbNewLocationParent").combotree({valueField:"id",textField:"name",data:cache_locations}),$("#fldNewLocationCode").textbox({onChange:function(e,o){_.isBlank(e)?$("#btnLocationNewAdd").linkbutton("disable"):e!=o&&doServerDataMessage("checklocationcode",{locationid:r,code:e},{type:"refresh"})}}),$("#cbNewLocationCountry").combobox({valueField:"country",textField:"country",data:cache_countries,onSelect:function(e){o=doGetStatesFromCountry(e.country),$("#cbNewLocationState").combobox("loadData",o)}}),$("#cbNewLocationState").combobox({valueField:"state",textField:"state",data:o}),u?$("#btnLocationNewAdd").linkbutton({text:"Add"}):$("#btnLocationNewAdd").linkbutton({text:"Save"}),_.isUndefined(r)||_.isNull(r)?a():doServerDataMessage("loadlocation",{locationid:r},{type:"refresh"})},buttons:[{text:"Add",disabled:!0,id:"btnLocationNewAdd",handler:function(){var e=doGetComboTreeSelectedId("cbNewLocationParent"),o=$("#fldNewLocationName").textbox("getValue"),t=$("#fldNewLocationCode").textbox("getValue"),a=$("#fldNewLocationBay").textbox("getValue"),n=$("#fldNewLocationLevel").textbox("getValue"),c=$("#fldNewLocationShelf").textbox("getValue"),d=$("#fldNewLocationAddress1").textbox("getValue"),l=$("#fldNewLocationAddress2").textbox("getValue"),i=$("#fldNewLocationCity").textbox("getValue"),s=$("#fldNewLocationPostcode").textbox("getValue"),b=$("#cbNewLocationCountry").combobox("getValue"),x=$("#cbNewLocationState").combobox("getValue");_.isBlank(o)?doMandatoryTextbox("Please enter an location name","fldNewLocationName"):_.isBlank(t)?doMandatoryTextbox("Please enter a unique location code","fldNewLocationCode"):u?doServerDataMessage("newlocation",{parentid:e,name:o,code:t,bay:a,level:n,shelf:c,address1:d,address2:l,city:i,state:x,postcode:s,country:b},{type:"refresh"}):doServerDataMessage("savelocation",{locationid:r,name:o,code:t,bay:a,level:n,shelf:c,address1:d,address2:l,city:i,state:x,postcode:s,country:b},{type:"refresh"})}},{text:"Reset",handler:function(){a()}},{text:"Close",handler:function(){$("#dlgLocationNew").dialog("close")}}]}).dialog("center").dialog("open")}